(function(g){var window=this;'use strict';var GU8=function(G){var B=new g.GO("und",new g.e2("Default","und",!0));B.captionTracks=G.captionTracks;return B},Bjf=function(G){return new g.z5(function(B,a){var V=G.length,x=[];
if(V)for(var h=function(l,k){V--;x[l]=k;V==0&&B(x)},e=function(l){a(l)},w,K=0;K<G.length;K++)w=G[K],g.on_(w,g.MY(h,K),e);
else B(x)})},Ru=function(G){this.j=G},Z2=function(){Ru.apply(this,arguments)},afs=function(){Z2.apply(this,arguments)},Vvs=function(){Z2.apply(this,arguments)},xo7=function(){Z2.apply(this,arguments)},he2=function(){Z2.apply(this,arguments)},ee2=function(){Z2.apply(this,arguments)},WXh=function(){Z2.apply(this,arguments)},wRC=function(){Ru.apply(this,arguments)},KXW=function(){Z2.apply(this,arguments)},lfC=function(){Z2.apply(this,arguments)},kUJ=function(){Z2.apply(this,arguments)},Njs=function(){Z2.apply(this,
arguments)},do$=function(){Z2.apply(this,arguments)},CA$=function(){Z2.apply(this,arguments)},zea=function(){Z2.apply(this,arguments)},tvJ=function(){Z2.apply(this,arguments)},mo2=function(){Z2.apply(this,arguments)},Iff=function(){Z2.apply(this,arguments)},gO2=function(){Z2.apply(this,arguments)},pRs=function(){Z2.apply(this,arguments)},Uo9=function(){Ru.apply(this,arguments)},Oc$=function(){Z2.apply(this,arguments)},EOh=function(){Z2.apply(this,arguments)},jQ$=function(){Z2.apply(this,arguments)},
bc7=function(){Z2.apply(this,arguments)},yfs=function(){Z2.apply(this,arguments)},cf2=function(){Z2.apply(this,arguments)},nOC=function(){Z2.apply(this,arguments)},fff=function(){Z2.apply(this,arguments)},Hcs=function(){Z2.apply(this,arguments)},vOC=function(){Ru.apply(this,arguments)},DoC=function(){Ru.apply(this,arguments)},SWh=function(){Ru.apply(this,arguments)},Reh=function(){Z2.apply(this,arguments)},Zcl=function(){Z2.apply(this,arguments)},rfa=function(){Z2.apply(this,arguments)},$os=function(){Z2.apply(this,
arguments)},XR7=function(){Z2.apply(this,arguments)},qWf=function(){Z2.apply(this,arguments)},uN$=function(){Z2.apply(this,arguments)},QQJ=function(){Z2.apply(this,arguments)},LXl=function(){Z2.apply(this,arguments)},Tj2=function(){Z2.apply(this,arguments)},sQC=function(){Z2.apply(this,arguments)},FXC=function(){Z2.apply(this,arguments)},Jf$=function(){Z2.apply(this,arguments)},Af7=function(){Z2.apply(this,arguments)},YW2=function(){Z2.apply(this,arguments)},icl=function(){Z2.apply(this,arguments)},
PAC=function(){Z2.apply(this,arguments)},oOa=function(){Z2.apply(this,arguments)},Mv7=function(){Z2.apply(this,arguments)},GeC=function(){Z2.apply(this,arguments)},B$a=function(){Z2.apply(this,arguments)},a9l=function(){Z2.apply(this,arguments)},Vlf=function(){Z2.apply(this,arguments)},xtC=function(){Z2.apply(this,arguments)},hx3=function(){Z2.apply(this,arguments)},exa=function(){Z2.apply(this,arguments)},Wrh=function(){Ru.apply(this,arguments)},w17=function(){Z2.apply(this,arguments)},Kr$=function(){Z2.apply(this,
arguments)},l99=function(){Z2.apply(this,arguments)},kea=function(){Z2.apply(this,arguments)},N$3=function(){Z2.apply(this,arguments)},dt8=function(){Z2.apply(this,arguments)},Cr$=function(){Z2.apply(this,arguments)},zx7=function(){Z2.apply(this,arguments)},tl8=function(){Z2.apply(this,arguments)},mta=function(){Z2.apply(this,arguments)},I9C=function(){Z2.apply(this,arguments)},gZl=function(){Z2.apply(this,arguments)},p19=function(){Z2.apply(this,arguments)},UtC=function(){Z2.apply(this,arguments)},
O6a=function(){Z2.apply(this,arguments)},EZk=function(){Z2.apply(this,arguments)},jY8=function(){Z2.apply(this,arguments)},b6W=function(){Z2.apply(this,arguments)},yR8=function(){Z2.apply(this,arguments)},cR$=function(){Z2.apply(this,arguments)},nZh=function(){Z2.apply(this,arguments)},f9J=function(){Z2.apply(this,arguments)},H6s=function(){Z2.apply(this,arguments)},vZC=function(){Z2.apply(this,arguments)},Dt2=function(){Z2.apply(this,arguments)},S$h=function(){Z2.apply(this,arguments)},Rxk=function(){Z2.apply(this,
arguments)},Z6k=function(){Z2.apply(this,arguments)},rRJ=function(){Z2.apply(this,arguments)},$tC=function(){Z2.apply(this,arguments)},X19=function(G){G=G.key||G.id;
if(!G)throw Error("Entity key is missing");return G},q$C=function(){if(ru)return ru();
var G={};ru=g.M$("PersistentEntityStoreDb",{IC:(G.EntityStore={t6:1},G.EntityAssociationStore={t6:2},G),shared:!1,upgrade:function(B,a){a(1)&&g.Rt(g.nN(B,"EntityStore",{keyPath:"key"}),"entityType","entityType");a(2)&&(B=g.nN(B,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.Rt(B,"byParentEntityKey","parentEntityKey"),g.Rt(B,"byChildEntityKey","childEntityKey"))},
version:3});return ru()},uPl=function(G){return g.LN(q$C(),G)},QYC=function(G){return g.LN((0,g.SE3)(),G)},$6=function(G){this.token=G},XU=function(G,B){B=B===void 0?{}:B;
g.FI.call(this,g.RY3[G],Object.assign({},{name:"PESEncoderError",type:G},B));this.type=G;this.level="WARNING";Object.setPrototypeOf(this,XU.prototype)},Lr8=function(G){return new XU("WRONG_DATA_TYPE",{yO:G})},T$$=function(G){return G instanceof Error?new XU("UNKNOWN_ENCODE_ERROR",{MF:G.message}):new XU("UNKNOWN_ENCODE_ERROR")},sYf=function(G){return G instanceof Error?new XU("UNKNOWN_DECODE_ERROR",{MF:G.message}):new XU("UNKNOWN_DECODE_ERROR")},FrC=function(G,B){G=G instanceof XU?G:B(G);
g.RA(G);throw G;},JR8=function(){},ARC=function(G,B,a){try{return G.C(B,a)}catch(V){FrC(V,T$$)}},Y$2=function(G){G=(new TextEncoder).encode(G).subarray(0,16);
var B=new Uint8Array(16);B.set(G);return B},qX=function(G){this.j=G},PrJ=function(G){var B=i6h[G];
if(B)return B;g.Zb(new g.FI("Entity model not found.",{entityType:G}))},oZh=function(G,B){this.j=G;
this.X=B;this.C={}},GdW=function(G,B){a:{G=Mlh(G.X,B.version);
try{var a=G.X(B.data,B.key);break a}catch(V){FrC(V,sYf)}a=void 0}return a},uJ=function(G,B,a){return G.j.objectStore("EntityStore").get(B).then(function(V){if(V){if(a&&V.entityType!==a)throw Error("Incorrect entity type");
return GdW(G,V)}})},Qf=function(G,B,a){return a?(a=a.map(function(V){return uJ(G,V,B)}),g.OV.all(a)):G.j.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(B)).then(function(V){return V.map(function(x){return GdW(G,x)})})},Tr=function(G,B,a){var V=X19(B),x=Mlh(G.X,1),h=Object.assign({},B);
return G.j.objectStore("EntityStore").get(V).then(function(e){if(e){if(e.entityType!==a)throw Error("Incorrect entity type");h.entityMetadata||(e=GdW(G,e),h.entityMetadata=e.entityMetadata)}}).then(function(){var e={key:V,
entityType:a,data:ARC(x,h,V),version:1};return g.OV.all([g.vL(G.j.objectStore("EntityStore"),e),Bxf(G,h,a)])}).then(function(){L5(G,V,a);
return V})},ac2=function(G,B,a){B=B.map(function(V){return Tr(G,V,a)});
return g.OV.all(B)},sx=function(G,B,a){if(a==null?0:a.Vu){var V=new Set;
return V3k(G,B,V).then(function(){for(var h=[],e=g.m(V),w=e.next();!w.done;w=e.next())h.push(sx(G,w.value));return g.OV.all(h).then(function(){})})}var x=g.e9(B).entityType;
return g.OV.all([G.j.objectStore("EntityStore").delete(B),xVJ(G,B)]).then(function(){L5(G,B,x)})},ha3=function(G,B){return g.XC(G.j.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(B)},function(a){return g.OV.all([a.delete(),
xVJ(G,a.cursor.primaryKey)]).then(function(){L5(G,a.cursor.primaryKey,B);return g.rP(a)})})},eaf=function(G,B,a,V){var x=Mlh(G.X,1);
return uJ(G,B,V).then(function(h){if(h){h=g.tr(h,a);var e={key:B,entityType:V,data:ARC(x,h,B),version:1};return g.OV.all([g.vL(G.j.objectStore("EntityStore"),e),Bxf(G,h,V)])}}).then(function(){L5(G,B,V);
return B})},L5=function(G,B,a){var V=G.C[a];
V||(V=new Set,G.C[a]=V);V.add(B)},Wls=function(G,B,a){var V=X19(B);
a=PrJ(a);if(!a)return g.OV.resolve([]);a=new a(B);G=G.j.objectStore("EntityAssociationStore");B=[];a=g.m(a.X());for(var x=a.next();!x.done;x=a.next())B.push(g.vL(G,{parentEntityKey:V,childEntityKey:x.value}));return g.OV.all(B).then(function(h){return h.map(function(e){return e[1]})})},xVJ=function(G,B){return G.j.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(B))},Bxf=function(G,B,a){var V=X19(B);
return xVJ(G,V).then(function(){return Wls(G,B,a)})},V3k=function(G,B,a){if(a.has(B))return g.OV.resolve(void 0);
a.add(B);return wOW(G,B).then(function(V){return G.j.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(B)).then(function(){return V})}).then(function(V){var x=g.OV.resolve(void 0);
V=g.m(V);for(var h=V.next(),e={};!h.done;e={uP:void 0},h=V.next())e.uP=h.value,x=x.then(function(w){return function(){return V3k(G,w.uP,a)}}(e));
return x}).then(function(){})},wOW=function(G,B){var a=G.j.objectStore("EntityAssociationStore");
return a.index("byParentEntityKey").getAll(IDBKeyRange.only(B)).then(function(V){var x=[];V=g.m(V);for(var h=V.next();!h.done;h=V.next())h=h.value,x.push(a.index("byChildEntityKey").getAll(h.childEntityKey));return g.OV.all(x)}).then(function(V){var x=[];
V=g.m(V);for(var h=V.next();!h.done;h=V.next())h=h.value,h.length===1&&x.push(h[0].childEntityKey);return x})},FU=function(){},KlJ=function(){this.j={};
this.j[0]=new FU;if(!g.pB("aes_pes_encoder_killswitch")){var G=this.j;try{var B=g.Jt();var a=Y$2(B);var V=new qX(new g.Od(a),new g.Ud(a))}catch(x){throw G=x instanceof Error?new XU("KEY_CREATION_FAILED",{MF:x.message}):new XU("KEY_CREATION_FAILED"),g.RA(G),G;}G[1]=V}},Mlh=function(G,B){B=B===void 0?0:B;
G=G.j[B];if(!G)throw B=new XU("INVALID_ENCODER_VERSION",{yO:B}),g.RA(B),B;return G},Jv=function(G,B){g.r.call(this);
this.token=G;this.j=B;this.observers=[];G=new g.qY.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.Jt());G.onmessage=this.X.bind(this);this.channel=G},Av=function(G,B,a){var V,x,h,e;
return g.v(function(w){if(w.j==1)return g.f(w,uPl(G.token),2);if(w.j!=3)return V=w.X,g.f(w,g.HL(V,["EntityStore","EntityAssociationStore"],B,function(K){x=new oZh(K,G.j);return a(x)}),3);
h=w.X;x&&(e=x.C,Object.keys(e).length>0&&(G.channel.postMessage(e),lcl(G,e)));return w.return(h)})},Y6=function(G,B,a){return Av(G,{mode:"readwrite",
hs:!0},function(V){return Tr(V,B,a)})},kdf=function(G,B){return Av(G,{mode:"readwrite",
hs:!0},function(a){return ac2(a,B,"offlineOrchestrationActionWrapperEntity")})},Nxa=function(G,B){return Av(G,{mode:"readwrite",
hs:!0},function(a){return sx(a,B)})},dV7=function(G){return Av(G,{mode:"readwrite",
hs:!0},function(B){return ha3(B,"videoPlaybackPositionEntity")})},iJ=function(G,B,a){return Av(G,{mode:"readonly",
hs:!0},function(V){return uJ(V,B,a)})},Pc=function(G,B,a){return Av(G,{mode:"readonly",
hs:!0},function(V){return Qf(V,B,a)})},lcl=function(G,B){G=g.m(G.observers);
for(var a=G.next();!a.done;a=G.next())a=a.value,a(B)},CL9=function(){var G,B,a;
return g.v(function(V){if(V.j==1)return g.UA(V,2),g.f(V,g.PL(),4);if(V.j!=2){G=V.X;if(!G||!g.At()||typeof g.qY.BroadcastChannel==="undefined")return V.return();B=new KlJ;return V.return(new Jv(G,B))}a=g.jB(V);a instanceof Error&&g.RA(a);return V.return()})},ou=function(){zaJ||(zaJ=CL9());
return zaJ},t32=function(G){var B;
G=(B=G.options)==null?void 0:B.persistenceOption;return G==="ENTITY_PERSISTENCE_OPTION_PERSIST"||G==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},mV7=function(G){var B;
return g.v(function(a){return a.j==1?g.f(a,ou(),2):(B=a.X)?g.f(a,Av(B,"readwrite",function(V){for(var x={},h=g.m(G),e=h.next(),w={};!e.done;w={pE:void 0,yq:void 0},e=h.next())w.pE=e.value,w.pE.entityKey&&t32(w.pE)&&(w.yq=g.po(w.pE.payload),e=void 0,w.pE.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(e=function(K){return function(){return Tr(V,K.pE.payload[K.yq],K.yq)}}(w)),w.pE.type==="ENTITY_MUTATION_TYPE_DELETE"&&(e=function(K){return function(){return sx(V,K.pE.entityKey)}}(w)),w.pE.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(e=function(K){return function(){return eaf(V,K.pE.entityKey,K.pE.payload[K.yq],K.yq)}}(w)),e&&(x[w.pE.entityKey]=x[w.pE.entityKey]?x[w.pE.entityKey].then(e):e()));
return g.OV.all(Object.values(x))}),0):a.return()})},IcJ=function(G){var B;
return g.v(function(a){if(a.j==1){B=G.mutations;if(!B||B.length<=0)return a.return();if(g.BF){var V={type:"ENTITY_LOADED"};B!==void 0&&(V.payload=B);g.BF.dispatch(V)}return g.f(a,mV7(B),2)}B.length=0;g.pV(a)})},gaC=function(G){return G!==void 0},pO9=function(G){var B=g.c_();
B=Object.assign({},B);G=Object.assign({},G);for(var a in B)G[a]?(B[a]!==4&&(B[a]=G[a]),delete G[a]):B[a]!==2&&(B[a]=4);Object.assign(B,G);g.egH(B);JSON.stringify(B);return B},UV2=function(G){var B,a;
return g.v(function(V){if(V.j==1)return g.f(V,g.PL(),2);if(V.j!=3)return(B=V.X)?g.f(V,g.H_(B),3):V.return();a=V.X;return V.return(g.HL(a,["index","media","captions"],{mode:"readwrite",hs:!0},function(x){var h=IDBKeyRange.bound(G+"|",G+"~");x=[x.objectStore("index").delete(h),x.objectStore("media").delete(h),x.objectStore("captions").delete(h)];return g.OV.all(x).then(function(){})}))})},O42=function(){var G,B;
return g.v(function(a){if(a.j==1)return g.f(a,g.PL(),2);if(a.j!=3){G=a.X;if(!G)throw g.pN("rvdfd");return g.f(a,g.H_(G),3)}B=a.X;return a.return(g.HL(B,["index","media"],{mode:"readwrite",hs:!0},function(V){var x={};return g.ZP(V.objectStore("index"),{},function(h){var e=h.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),w=g.OV.resolve(void 0);if(e){var K=e[1];e=e[2];x[K]=x[K]||{};var l;x[K][e]=g.kEg((l=h.getValue())==null?void 0:l.fmts)}else w=h.delete().then(function(){});
return g.OV.all([g.rP(h),w]).then(function(k){return g.m(k).next().value})}).then(function(){for(var h={},e=g.m(Object.keys(x)),w=e.next();!w.done;w=e.next()){w=w.value;
var K=x[w].v;h[w]=x[w].a&&K?1:2}var l=pO9(h);return g.qJB(V.objectStore("media"),{},function(k){var N=k.cursor.key.match(g.zgB);N&&h[N[1]]||V.objectStore("media").delete(k.cursor.key);return g.Hm9(k)}).then(function(){return l})})}))})},Eas=function(G,B){var a,V;
return g.v(function(x){if(x.j==1)return g.f(x,g.PL(),2);if(x.j!=3){a=x.X;if(!a)throw g.pN("wct");return g.f(x,g.H_(a),3)}V=x.X;return g.f(x,g.HL(V,["captions"],{mode:"readwrite",hs:!0},function(h){var e=[];h=h.objectStore("captions");for(var w=0;w<B.length;w++){var K=g.vL(h,B[w],G+"|"+B[w].metadata.vss_id);e.push(K)}return g.OV.all(e)}),0)})},jqW=function(G){var B,a,V;
return g.v(function(x){if(x.j==1)return B=IDBKeyRange.bound(G+"|",G+"~"),g.f(x,g.PL(),2);if(x.j!=3){a=x.X;if(!a)throw g.pN("gactfv");return g.f(x,g.H_(a),3)}V=x.X;return x.return(V.getAll("captions",B))})},b4s=function(G){return g.v(function(B){g.f$(G,0);
return B.return(UV2(G))})},yIl=function(G){return{context:g.iy(),
videoIds:G}},cIk=function(G){return{context:g.iy(),
playlistIds:G}},nak=function(G){return{context:g.iy(),
offlinePlaylistSyncChecks:G}},fcs=function(){this.j=new Map},vaC=function(){H4s||(H4s=new fcs);
return H4s},DV9=function(G,B){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:G},metadata:B,statusCode:void 0,csn:void 0,can:void 0}},SK2=function(G,B,a){if(!a){var V=V===void 0?!1:V;
a=G.j.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!a||V)a=g.Et(16),G.j.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",a)}G={flowNonce:a,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:B.eventType};B.metadata&&(G.flowMetadata=B.metadata);B.statusCode!==void 0&&(G.flowEventStatus=B.statusCode);B.csn&&(G.csn=B.csn);B.can&&(G.can=B.can);g.wP("flowEvent",G,void 0)},Ra7=function(G){var B,a,V,x,h,e,w,K,l,k,N,d,C,z,p,O,b,c,H,R,q,A,J,xB,Wz,GK,Q,M,I,L,ux,U3,dl,cz,Pz,hJ,tJ,E,y,n;
return g.v(function(D){if(D.j==1)return g.f(D,Av(G,{mode:"readonly",hs:!0},function(Z){return Qf(Z,"playbackData").then(function(Bz){var hg=Bz.map(function(tg){return tg.transfer}).filter(function(tg){return!!tg}),eB=Bz.map(function(tg){return tg.offlineVideoPolicy}).filter(function(tg){return!!tg}),S=Bz.filter(function(tg){return!!tg.key}).map(function(tg){return g.WS(g.e9(tg.key).entityId,"downloadStatusEntity")});
hg=Qf(Z,"transfer",hg);eB=Qf(Z,"offlineVideoPolicy",eB);S=Qf(Z,"downloadStatusEntity",S);var kB=hg.then(function(tg){tg=tg.reduce(function(KV,vz){(vz==null?0:vz.offlineVideoStreams)&&KV.push.apply(KV,g.U(vz.offlineVideoStreams));return KV},[]).filter(function(KV){return!!KV});
return Qf(Z,"offlineVideoStreams",tg)});
return g.OV.all([hg,eB,kB,S]).then(function(tg){var KV=g.m(tg);tg=KV.next().value;var vz=KV.next().value;var Cs=KV.next().value;KV=KV.next().value;return[Bz,tg,vz,Cs,KV]})})}),2);
if(D.j!=3)return B=D.X,g.f(D,Av(G,{mode:"readonly",hs:!0},function(Z){return Qf(Z,"mainDownloadsListEntity").then(function(Bz){var hg,eB;return(eB=(hg=Bz[0])==null?void 0:hg.downloads)!=null?eB:[]})}),3);
a=D.X;V=g.m(B);x=V.next().value;h=V.next().value;e=V.next().value;w=V.next().value;K=V.next().value;l=x;k=h;N=e;d=w;C=K;z={};p={};O={};b={};c={};H=[];R=g.m(k);for(q=R.next();!q.done;q=R.next())(A=q.value)&&(z[A.key]=A);J=g.m(N);for(xB=J.next();!xB.done;xB=J.next())(Wz=xB.value)&&(p[Wz.key]=Wz);GK=g.m(C);for(Q=GK.next();!Q.done;Q=GK.next())(M=Q.value)&&(O[M.key]=M);I=g.m(d);for(L=I.next();!L.done;L=I.next())(ux=L.value)&&(b[ux.key]=ux);U3=g.m(a);for(dl=U3.next();!dl.done;dl=U3.next())cz=dl.value,Pz=
void 0,c[(Pz=cz.videoItem)!=null?Pz:""]=!0,cz.videoItem&&(tJ=hJ=void 0,E=(tJ=(hJ=g.e9(cz.videoItem))==null?void 0:hJ.entityId)!=null?tJ:"",H.push({externalVideoId:E}));y=l.filter(function(Z){if(!Z||!Z.key||!Z.offlineVideoPolicy)return!1;Z=g.e9(Z.key).entityId;Z=g.WS(Z,"downloadStatusEntity");var Bz;return!(Z&&((Bz=O[Z])==null?void 0:Bz.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
n=y.map(function(Z){var Bz=z[Z.transfer],hg=[];if(Bz==null?0:Bz.offlineVideoStreams)for(var eB=g.m(Bz.offlineVideoStreams),S=eB.next();!S.done;S=eB.next())(S=b[S.value])&&hg.push(S);eB=p[Z.offlineVideoPolicy];S=c;var kB=Z==null?void 0:Z.playerResponseTimestamp,tg=g.e9(eB.key).entityId;Z=g.WS(tg,"mainVideoEntity");if(eB.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var KV="OFFLINE_VIDEO_STATE_DISABLED";eB.expirationTimestamp&&Number(eB.expirationTimestamp)<Date.now()/1E3&&(KV="OFFLINE_VIDEO_STATE_EXPIRED")}else if(eB.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")KV="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(Bz==null?void 0:Bz.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":KV="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":KV="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":KV="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":KV="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":KV="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":KV="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:KV="OFFLINE_VIDEO_STATE_UNKNOWN"}if(KV==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(Bz==null?void 0:Bz.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":KV="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":KV="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":KV=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}tg={id:tg,videoState:KV};if(Bz==null?0:Bz.cotn)tg.cotn=Bz.cotn;if(Bz==null?0:Bz.maximumDownloadQuality)tg.selectedVideoQuality=Bz==null?void 0:Bz.maximumDownloadQuality;if(Bz==null?0:Bz.lastProgressTimeMs)tg.lastProgressTimeMs=Bz.lastProgressTimeMs;kB&&(tg.playerResponseSavedTimeMs=String(Number(kB)*1E3));Bz=String;kB=0;hg=g.m(hg);for(KV=hg.next();!KV.done;KV=hg.next())if(KV=KV.value,KV.streamsProgress){KV=g.m(KV.streamsProgress);for(var vz=KV.next();!vz.done;vz=
KV.next()){var Cs=void 0;kB+=Number((Cs=vz.value.numBytesDownloaded)!=null?Cs:0)}}tg.downloadedBytes=Bz(kB);tg.selectedOfflineMode=S[Z]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";eB.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(tg.offlinePlaybackDisabledReason=eB.offlinePlaybackDisabledReason);return tg});
return D.return({offlineVideos:n,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:H}}})})},Z4a=function(){this.locks=navigator.locks},rI8=function(){try{var G=g.LV("ytglobal.locks_");
if(G)return G;var B;if(B=navigator){var a=navigator;B="locks"in a&&!!a.locks}if(B)return g.qY.localStorage&&g.qY.localStorage.getItem("noop"),G=new Z4a,g.Qb("ytglobal.locks_",G),G}catch(V){}},MX=function(){},$VC=function(){},XO$=function(G){if(G.includes(":"))throw Error("Invalid user cache name: "+G);
return G+":"+g.Jt("CacheStorage get")},qK3=function(){return g.v(function(G){if(GW!==void 0)return G.return(GW);
GW=new Promise(function(B){var a;return g.v(function(V){switch(V.j){case 1:return g.UA(V,2),g.f(V,By.open("test-only"),4);case 4:return g.f(V,By.delete("test-only"),5);case 5:g.EA(V,3);break;case 2:if(a=g.jB(V),a instanceof Error&&a.name==="SecurityError")return B(!1),V.return();case 3:B("caches"in window),g.pV(V)}})});
return G.return(GW)})},QqC=function(){return g.v(function(G){if(G.j==1)return g.f(G,qK3(),2);
if(!G.X)return G.return(void 0);uTJ||(uTJ=new $VC);return G.return(uTJ)})},a8=function(G,B,a){g.Zb(new g.FI("Woffle: "+G,a?{cotn:a}:""));
B instanceof Error&&g.Zb(B)},LlC=function(G){var B;
return g.v(function(a){if(a.j==1)return g.f(a,Ra7(G),2);B=a.X;g.wP("offlineStateSnapshot",B);g.pV(a)})},Vh=function(G){g.r.call(this);
var B=this;this.api=G;this.vC={Ou1:function(){return B.j},
rtJ:function(){return B.X}};
typeof g.qY.BroadcastChannel!=="undefined"&&(this.j=new g.qY.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.Jt()),this.j.onmessage=this.C.bind(this),this.X=new g.qY.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.Jt()),this.X.onmessage=this.G.bind(this))},xP=function(G,B){G.api.pN("onOfflineOperationFailure",B);
var a;(a=G.j)==null||a.postMessage(B)},Txs=function(G,B,a,V){var x=this;
this.V=G;this.Y=B;this.visibility=a;this.S=V;this.B=this.W=this.L=this.C=this.j=!1;this.G=new g.J8(function(){x.TO()});
this.vC={rI:function(){return x.X},
TO:function(){x.TO()},
k9X:function(){return x.G}};
this.visibility.subscribe("visibilitystatechange",function(){x.Ry()})},sqf=function(G){if(!G.C&&!G.j){var B=rI8();
if(B){G.C=!0;var a=g.Jt("OfflineLockManager");B.request("woffle_orchestration_leader:"+a,{},function(){var V,x,h,e;return g.v(function(w){switch(w.j){case 1:return g.UA(w,2),G.X=new g.z_,G.j=!0,G.C=!1,g.f(w,G.V(),4);case 4:return g.f(w,G.X.promise,5);case 5:g.EA(w,0);break;case 2:V=g.jB(w),((h=(x=G).S)==null?0:h.call(x,"wo_relinquish_leadership_on_lock_request_error"))||G.TO(),V instanceof Error&&(e=V,e.args=[{name:"WoLockManagerError",aL:V.name}],g.RA(e)),g.pV(w)}})})}}},Fla=function(G){G.j&&(G.B=
!0,hS(G))},JI$=function(G,B){G.j&&(G.L=B,hS(G))},AIC=function(G,B){G.j&&(G.W=B,hS(G))},hS=function(G){G.W&&G.L&&G.B&&G.visibility.isBackground()?g.iC(G.G,6E4):G.G.stop()},ei=function(G){var B;
G.offlineDeleteReason=(B=G.offlineDeleteReason)!=null?B:"OFFLINE_DELETE_REASON_UNKNOWN";var a;G.offlineModeType=(a=G.offlineModeType)!=null?a:"OFFLINE_NOW";g.wP("offlineDeleteEvent",G)},Wy=function(G,B){var a=B.videoId;
var V=B.oe;B=B.offlineModeType;G.encryptedVideoId=a;G.cotn=V==null?void 0:V.cotn;G.offlineabilityFormatType=V==null?void 0:V.maximumDownloadQuality;var x;G.isRefresh=(x=V==null?void 0:V.isRefresh)!=null?x:!1;var h;G.softErrorCount=(h=V==null?void 0:V.transferRetryCount)!=null?h:0;G.offlineModeType=B!=null?B:"OFFLINE_NOW";(G.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&G.statusType==="UNKNOWN_STATUS_TYPE"||!G.transferStatusType&&!G.statusType)&&g.Zb(Error("Woffle unknown transfer status"));
g.wP("offlineTransferStatusChanged",G)},YKk=function(G,B,a,V){V={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!V};B&&a&&(B=Math.floor(B/1024).toFixed(),a=Math.floor(a/1024).toFixed(),V.alreadyDownloadedKbytes=B,V.totalFetchedKbytes=B,V.totalContentKbytes=a);Wy(V,G)},i4f=function(G){Wy({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},G)},PLl=function(G){switch(G){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
wn=function(G){var B,a,V;
return((V=(B=G.actionMetadata)==null?void 0:(a=B.retryScheduleIntervalsInSeconds)==null?void 0:a.length)!=null?V:0)>0},KC=function(G){return G.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!G.entityKey},lZ=function(G){return G.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!G.entityKey},kP=function(G){return G.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!G.entityKey},oas=function(G){return G.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!G.entityKey},
Ni=function(G,B,a,V,x){x=x===void 0?!1:x;
var h,e,w,K,l,k;return g.v(function(N){if(N.j==1)return h=g.WS(G,B),e=g.WS(G,"downloadStatusEntity"),g.f(N,Av(a,{mode:"readonly",hs:!0},function(d){return g.OV.all([uJ(d,h,B),uJ(d,e,"downloadStatusEntity")])}),2);
w=N.X;K=w.length?w[0]:void 0;if(!K)return N.kf(0);l=M3a;if(k=w.length>1?w[1]:void 0){if(k.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!x)return N.return();k.downloadState=V}else k={key:e,downloadState:V};g.uY(K,l,k);return g.f(N,Av(a,{mode:"readwrite",hs:!0},function(d){return g.OV.all([Tr(d,K,B),Tr(d,k,"downloadStatusEntity")])}),0)})},dn=function(G,B){return G.actionType===B.actionType&&G.entityKey===B.entityKey},CC=function(G,B){if(G&&G.transferState!=="TRANSFER_STATE_COMPLETE"&&G.transferState!==
"TRANSFER_STATE_FAILED"){var a=g.e9(G.key).entityId;
Wy({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:a,oe:G,offlineModeType:B})}},zW=function(G){if(!G||!G.thumbnails)return[];
var B=[];G=g.m(G.thumbnails);for(var a=G.next();!a.done;a=G.next())a=a.value,a.url&&B.push(a.url);return B},GR2=function(G,B,a){a=a===void 0?[]:a;
var V,x,h,e,w,K,l,k,N,d,C,z,p;return g.v(function(O){if(O.j==1)return a.length?g.f(O,Pc(G,B),2):O.return([]);V=O.X;x=new Set;h=g.m(V);for(e=h.next();!e.done;e=h.next())if(w=e.value,K=w.id||w.key)l=g.e9(K).entityId,x.add(l);k=[];N=g.m(a);for(d=N.next();!d.done;d=N.next())C=d.value,z=C.offlineVideoData,p=void 0,((p=z)==null?0:p.videoId)&&!x.has(z.videoId)&&k.push(C);return O.return(k)})},Bbh=function(G,B,a){return new g.Tk(G,{cotn:B,
raw_player_response:a,download_media:!0,start:Infinity,disable_watch_next:!0})},apa=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},tS=function(G,B,a,V,x,h,e,w,K,l,k){this.entityType=G;
this.actionId=B;this.action=a;this.parentActionId=V;this.rootActionId=x===void 0?B:x;this.childActionIds=h;this.prereqActionId=e;this.postreqActionIds=w;this.hasChildActionFailed=l;this.retryScheduleIndex=0;this.j=k||Date.now();this.retryScheduleIndex=K||0},mx=function(G){if(!G.key)throw Error("Entity key is required.");
if(!G.actionProto)throw Error("OfflineOrchestrationAction is required.");var B=g.e9(G.key),a=g.e9(G.actionProto.entityKey);return new tS(a.entityType,B.entityId,G.actionProto,G.parentActionId,G.rootActionId,G.childActionIds,G.prereqActionId,G.postreqActionIds,G.retryScheduleIndex,G.hasChildActionFailed,Number(G.enqueueTimeSec)*1E3)},I8=function(G){return{key:g.WS(G.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:G.action,parentActionId:G.parentActionId,rootActionId:G.rootActionId,childActionIds:G.childActionIds,prereqActionId:G.prereqActionId,postreqActionIds:G.postreqActionIds,retryScheduleIndex:G.retryScheduleIndex,hasChildActionFailed:G.hasChildActionFailed,enqueueTimeSec:(G.j/1E3).toFixed()}},Vp2=function(){var G;
return g.v(function(B){return B.j==1?g.f(B,QqC(),2):(G=B.X)?B.return(G.delete("yt-player-local-img")):B.return(!0)})},gn=function(G){var B,a;
return g.v(function(V){if(V.j==1)return g.f(V,QqC(),2);if(V.j!=3){B=V.X;if(!B)throw Error("Cache API not supported");return G.length?g.f(V,B.open("yt-player-local-img"),3):V.return()}a=V.X;return g.f(V,Promise.all(G.map(function(x){return a.delete(x)})),0)})},pC=function(G){var B,a;
return g.v(function(V){if(V.j==1)return g.f(V,QqC(),2);if(V.j!=3){B=V.X;if(!B)throw Error("Cache API not supported");return G.length?g.f(V,B.open("yt-player-local-img"),3):V.return()}a=V.X;return g.f(V,a.addAll(G),0)})},US=function(G,B,a,V,x){var h,e,w,K,l,k,N,d,C,z,p,O,b,c,H,R,q,A,J,xB,Wz,GK,Q,M,I,L,ux,U3,dl,cz,Pz;
return g.v(function(hJ){switch(hJ.j){case 1:return h=g.WS(G,"mainVideoEntity"),e=g.WS(G,"ytMainChannelEntity"),w=g.WS(G,"transfer"),K=g.WS(G,"videoDownloadContextEntity"),g.f(hJ,Av(B,{mode:"readonly",hs:!0},function(tJ){return g.OV.all([uJ(tJ,h,"mainVideoEntity"),uJ(tJ,e,"ytMainChannelEntity"),uJ(tJ,w,"transfer"),uJ(tJ,K,"videoDownloadContextEntity"),Qf(tJ,"ytMainChannelEntity"),Qf(tJ,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:l=hJ.X;k=g.m(l);N=k.next().value;d=k.next().value;C=k.next().value;z=k.next().value;p=k.next().value;O=k.next().value;b=N;c=d;H=C;R=z;q=p;A=O;if(!b&&!c){hJ.kf(3);break}J=b?zW(b.thumbnail):[];if(!c){xB=[];hJ.kf(4);break}return g.f(hJ,x7s(c,q),5);case 5:xB=hJ.X;case 4:return Wz=xB,g.f(hJ,gn(J.concat(Wz)),3);case 3:GK=[];Q=g.WS(G,"downloadStatusEntity");M=g.m(A);for(I=M.next();!I.done;I=M.next())L=I.value,ux=g.e9(L.key).entityId,U3=mx(L),dl=g.e9(U3.action.entityKey).entityId,ux!==G&&dl!==G||dn(a,
L.actionProto)||GK.push(L.key);return g.f(hJ,Av(B,{mode:"readwrite",hs:!0},function(tJ){var E=GK.map(function(y){return sx(tJ,y)});
E.push(sx(tJ,h,{Vu:!0}));E.push(sx(tJ,Q,{Vu:!0}));return g.OV.all(E)}),7);
case 7:Pz=(cz=R)==null?void 0:cz.offlineModeType,x&&(ei(x),x.offlineModeType&&(Pz=x.offlineModeType)),CC(H,Pz),xP(V,{entityKey:h,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.pV(hJ)}})},W8l=function(G,B,a,V){var x,h,e,w,K,l,k,N,d,C,z,p,O,b,c,H,R,q,A,J,xB,Wz,GK,Q,M,I,L,ux,U3,dl,cz,Pz,hJ,tJ,E,y,n,D,Z,Bz,hg,eB,S,kB,tg,KV,vz,Cs,Xh,dK;
return g.v(function(sA){switch(sA.j){case 1:return x=g.WS(G,"mainPlaylistEntity"),h=g.WS(G,"ytMainChannelEntity"),g.f(sA,Av(B,{mode:"readonly",hs:!0},function(qU){return g.OV.all([uJ(qU,x,"mainPlaylistEntity"),uJ(qU,h,"ytMainChannelEntity"),Qf(qU,"mainPlaylistEntity"),Qf(qU,"mainDownloadsListEntity"),Qf(qU,"ytMainChannelEntity"),Qf(qU,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:e=sA.X;w=g.m(e);K=w.next().value;l=w.next().value;k=w.next().value;N=w.next().value;d=w.next().value;C=w.next().value;z=K;p=l;O=k;b=N;c=d;H=C;if(!z&&!p){sA.kf(3);break}R=z?hOs(z):[];if(!p){q=[];sA.kf(4);break}return g.f(sA,x7s(p,c),5);case 5:q=sA.X;case 4:return A=q,g.f(sA,gn(R.concat(A)),3);case 3:J=[];xB=new Map;if(!z){sA.kf(7);break}return g.f(sA,eOl(z,O,b),8);case 8:J=sA.X;Wz=g.m(J);for(GK=Wz.next();!GK.done;GK=Wz.next())Q=GK.value,xB.set(Q,{videoId:Q,playlistId:G,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.f(sA,Av(B,{mode:"readonly",hs:!0},function(qU){return g.OV.all([Qf(qU,"transfer"),Qf(qU,"videoDownloadContextEntity")])}),9);
case 9:M=sA.X;I=g.m(M);L=I.next().value;ux=I.next().value;U3=L;dl=ux;cz=g.m(U3);for(Pz=cz.next();!Pz.done;Pz=cz.next())hJ=Pz.value,tJ=g.e9(hJ.key).entityId,(E=xB.get(tJ))&&hJ&&(E.cotn=hJ.cotn);y=g.m(dl);for(n=y.next();!n.done;n=y.next())D=n.value,Z=g.e9(D.key).entityId,(Bz=xB.get(Z))&&D&&(Bz.offlineModeType=D.offlineModeType);case 7:hg=[];eB=g.m(H);for(S=eB.next();!S.done;S=eB.next())kB=S.value,tg=g.e9(kB.key).entityId,KV=mx(kB),tg!==G&&KV.rootActionId!==G||dn(a,kB.actionProto)||hg.push(kB.key);vz=
g.WS(G,"mainPlaylistEntity");return g.f(sA,Av(B,{mode:"readwrite",hs:!0},function(qU){var K0=hg.map(function(vq){return sx(qU,vq)});
K0.push(sx(qU,vz,{Vu:!0}));return g.OV.all(K0)}),10);
case 10:if(!z){sA.kf(0);break}J.reverse();if(!J){sA.kf(0);break}Cs=g.m(J);Xh=Cs.next();case 13:if(Xh.done){sA.kf(0);break}dK=Xh.value;return g.f(sA,US(dK,B,a,V,xB.get(dK)),14);case 14:Xh=Cs.next(),sA.kf(13)}})},K83=function(G,B,a,V){var x,h,e,w,K,l,k,N,d;
return g.v(function(C){if(C.j==1)return x=g.WS("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),h=new Map,g.f(C,Av(G,{mode:"readwrite",hs:!0},function(z){var p=Qf(z,"transfer"),O=Qf(z,"offlineOrchestrationActionWrapperEntity"),b=Qf(z,"videoDownloadContextEntity"),c=uJ(z,x,"mainDownloadsListEntity");return g.OV.all([p,O,b,c]).then(function(H){H=g.m(H);var R=H.next().value;var q=H.next().value;var A=H.next().value;var J=H.next().value;H=wd8.map(function(Wz){return ha3(z,Wz)});
q=g.m(q);for(var xB=q.next();!xB.done;xB=q.next())xB=xB.value,dn(B,xB.actionProto)||H.push(sx(z,xB.key,{Vu:!0}));J&&(J.downloads=[],H.push(Tr(z,J,"mainDownloadsListEntity")));if(A)for(A=g.m(A),J=A.next();!J.done;J=A.next())J=J.value,q=g.e9(J.key).entityId,q=g.WS(q,"transfer"),h.set(q,J.offlineModeType);return g.OV.all(H).then(function(){return R})})}),2);
e=C.X;w=g.m(e);for(K=w.next();!K.done;K=w.next())l=K.value,CC(l,h.get(l.key)),k=g.e9(l.key).entityId,N={videoId:k,offlineDeleteReason:V,cotn:l.cotn,offlineModeType:h.get(l.key)},ei(N),d=g.WS(k,"mainVideoEntity"),xP(a,{entityKey:d,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.f(C,Vp2(),0)})},hOs=function(G,B){var a=[];
if(G.thumbnailStyleData){G=g.m(G.thumbnailStyleData);for(var V=G.next();!V.done;V=G.next()){var x=void 0,h=void 0,e=void 0;a=a.concat(zW((x=V.value)==null?void 0:(h=x.value)==null?void 0:(e=h.collageThumbnail)==null?void 0:e.coverThumbnail))}}B=zW(B);return a.concat(B)},eOl=function(G,B,a){var V,x,h,e,w,K,l,k,N,d,C,z,p,O,b,c,H,R,q,A,J,xB,Wz;
return g.v(function(GK){V=[];x=new Set;if(a.length)for(h=g.m(a),e=h.next();!e.done;e=h.next())if(w=e.value,K=void 0,(K=w.downloads)==null?0:K.length)for(l=g.m(w.downloads),k=l.next();!k.done;k=l.next())N=k.value,N.videoItem&&(d=g.e9(N.videoItem).entityId,x.add(d));if(G.videos){C=g.m(G.videos);for(z=C.next();!z.done;z=C.next())p=z.value,O=JSON.parse(g.e9(p).entityId),O.videoId&&!x.has(O.videoId)&&V.push(O.videoId);b=g.m(B);for(c=b.next();!c.done;c=b.next())if(H=c.value,H.key!==G.key&&(R=H.videos))for(q=
g.m(R),A=q.next();!A.done;A=q.next())J=A.value,xB=JSON.parse(g.e9(J).entityId),xB.videoId&&(Wz=V.indexOf(xB.videoId),Wz!==-1&&V.splice(Wz,1))}return GK.return(V)})},x7s=function(G,B){var a,V,x,h,e,w,K,l;
return g.v(function(k){a=zW(G.avatar);V=g.m(B);for(x=V.next();!x.done;x=V.next())if(h=x.value,h.id!==G.id)for(e=g.m(zW(h.avatar)),w=e.next();!w.done;w=e.next())K=w.value,l=a.indexOf(K),l!==-1&&a.splice(l,1);return k.return(a)})},lpC=function(G){var B;
return g.v(function(a){B=g.u(G.frameworkUpdates,OS);return G.frameworkUpdates&&B?g.f(a,IcJ(B),0):a.return()})},Nb$=function(G){var B;
if((B=G.onResponseReceivedActions)!=null&&B.length){var a;G=(a=g.u(g.u(G.onResponseReceivedActions[0],kR7),g.fC3))==null?void 0:a.actions;if(G!=null&&G.length)return G}},d7a=function(G){var B,a,V;
return g.v(function(x){if(x.j==1)return G?g.f(x,iJ(G,g.S4,"mainDownloadsListEntity"),2):x.return([]);B=x.X;return((a=B)==null?0:(V=a.downloads)==null?0:V.length)?x.return(B.downloads.map(function(h){var e;return(e=h.videoItem)!=null?e:""})):x.return([])})},zO3=function(G,B){var a;
return g.v(function(V){return V.j==1?g.f(V,CG$(G,B),2):(a=V.X)?g.f(V,Av(G,{mode:"readwrite",hs:!0},function(x){var h=[Tr(x,a.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];a.mainDownloadsListEntity&&h.push(Tr(x,a.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.OV.all(h)}),0):V.kf(0)})},CG$=function(G,B){var a,V,x,h,e,w,K,l,k,N,d,C,z,p,O,b,c,H;
return g.v(function(R){if(R.j==1)return a=g.WS("main_downloads_library_id","mainDownloadsLibraryEntity"),V=g.WS("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.f(R,Av(G,{mode:"readonly",hs:!0},function(q){return g.OV.all([uJ(q,a,"mainDownloadsLibraryEntity"),uJ(q,V,"mainDownloadsListEntity")])}),2);
x=R.X;h=g.m(x);e=h.next().value;w=h.next().value;K=e;l=w;K||(K={id:a});k=g.m(B);for(N=k.next();!N.done;N=k.next())if(d=N.value,d===g.S4){if(K.smartDownloadsList)return R.return();K.smartDownloadsList=d}else if(C=g.e9(d).entityType,z={},C==="mainPlaylistEntity"?z.playlistItem=d:C==="mainVideoEntity"&&(z.videoItem=d),!g.yw(z)){p=void 0;if((p=l)==null?0:p.downloads){O=!1;b=g.m(l.downloads);for(c=b.next();!c.done;c=b.next())if(H=c.value,H.playlistItem===d||H.videoItem===d){O=!0;break}O||l.downloads.push(z)}else l=
{id:V,downloads:[z]};K.downloadsList=V}return R.return({mainDownloadsLibraryEntity:K,mainDownloadsListEntity:l})})},tp$=function(G,B){var a,V,x,h,e,w,K,l,k,N,d,C,z,p,O;
return g.v(function(b){if(b.j==1)return a=g.WS("main_downloads_library_id","mainDownloadsLibraryEntity"),V=g.WS("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.f(b,Av(G,{mode:"readonly",hs:!0},function(c){return g.OV.all([uJ(c,a,"mainDownloadsLibraryEntity"),uJ(c,V,"mainDownloadsListEntity"),uJ(c,g.S4,"mainDownloadsListEntity")])}),2);
x=b.X;h=g.m(x);e=h.next().value;w=h.next().value;K=h.next().value;l=e;k=w;N=K;if(!l)return b.kf(0);if(B===g.S4&&((d=N)==null?0:d.downloads))N.downloads=[];else if((C=k)==null?0:C.downloads)for(z=g.e9(B).entityType,p=0;p<k.downloads.length;p++)if(O=k.downloads[p],z==="mainVideoEntity"&&O.videoItem===B){k.downloads.splice(p,1);break}else if(z==="mainPlaylistEntity"&&O.playlistItem===B){k.downloads.splice(p,1);break}return g.f(b,Av(G,{mode:"readwrite",hs:!0},function(c){var H=[Tr(c,l,"mainDownloadsLibraryEntity")];
k&&H.push(Tr(c,k,"mainDownloadsListEntity"));N&&H.push(Tr(c,N,"mainDownloadsListEntity"));return g.OV.all(H)}),0)})},ES=function(G,B){var a,V,x,h,e,w,K,l,k,N,d;
return g.v(function(C){if(C.j==1)return a=g.WS(B,"transfer"),V=g.WS(B,"videoDownloadContextEntity"),g.f(C,Av(G,{mode:"readonly",hs:!0},function(z){return g.OV.all([uJ(z,a,"transfer"),uJ(z,V,"videoDownloadContextEntity")])}),2);
x=C.X;h=g.m(x);e=h.next().value;w=h.next().value;K=e;l=w;d={videoId:B,cotn:(k=K)==null?void 0:k.cotn,offlineModeType:(N=l)==null?void 0:N.offlineModeType};return C.return(d)})},ji=function(G,B,a,V,x){var h,e,w,K,l,k,N,d,C,z,p,O,b,c,H,R,q,A,J,xB;
return g.v(function(Wz){switch(Wz.j){case 1:return h=g.WS(G,"musicTrack"),e=g.WS(G,"transfer"),g.f(Wz,Av(B,{mode:"readonly",hs:!0},function(GK){return g.OV.all([uJ(GK,h,"musicTrack"),uJ(GK,e,"transfer"),Qf(GK,"musicTrack"),Qf(GK,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:w=Wz.X;K=g.m(w);l=K.next().value;k=K.next().value;N=K.next().value;d=K.next().value;C=l;z=k;p=N;O=d;if(!C){Wz.kf(3);break}return g.f(Wz,m72(C,p),4);case 4:return b=Wz.X,g.f(Wz,gn(b),3);case 3:c=[];H=g.m(O);for(R=H.next();!R.done;R=H.next())q=R.value,A=g.e9(q.key).entityId,J=mx(q),xB=g.e9(J.action.entityKey).entityId,A!==G&&xB!==G||dn(a,q.actionProto)||c.push(q.key);return g.f(Wz,Av(B,{mode:"readwrite",hs:!0},function(GK){var Q=c.map(function(M){return sx(GK,M)});
Q.push(sx(GK,h,{Vu:!0}));return g.OV.all(Q)}),6);
case 6:CC(z),x&&ei(x),xP(V,{entityKey:h,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.pV(Wz)}})},bZ=function(G,B,a,V,x){var h,e,w,K,l,k,N,d,C,z,p,O,b,c,H,R,q,A,J,xB,Wz,GK,Q,M,I,L,ux,U3,dl,cz,Pz,hJ,tJ,E,y,n;
return g.v(function(D){switch(D.j){case 1:return h=g.WS(G,B),e=g.WS("music_downloads_library_id","musicDownloadsLibraryEntity"),g.f(D,Av(a,{mode:"readonly",hs:!0},function(Z){return g.OV.all([uJ(Z,h,B),uJ(Z,e,"musicDownloadsLibraryEntity"),Qf(Z,B),Qf(Z,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:w=D.X;K=g.m(w);l=K.next().value;k=K.next().value;N=K.next().value;d=K.next().value;C=l;z=k;p=N;O=d;if(!C){D.kf(3);break}return g.f(D,m72(C,p),4);case 4:return b=D.X,g.f(D,gn(b),3);case 3:c=[];H=new Map;if(!C){D.kf(6);break}return g.f(D,Ip2(C,p,z),7);case 7:c=D.X;R=g.m(c);for(q=R.next();!q.done;q=R.next())A=q.value,J=g.e9(A).entityId,H.set(J,{videoId:J,playlistId:G,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.f(D,Pc(a,"transfer"),8);case 8:for(xB=D.X,Wz=g.m(xB),
GK=Wz.next();!GK.done;GK=Wz.next())Q=GK.value,M=g.e9(Q.key).entityId,(I=H.get(M))&&Q&&(I.cotn=Q.cotn);case 6:L=[];ux=g.m(O);for(U3=ux.next();!U3.done;U3=ux.next())dl=U3.value,cz=g.e9(dl.key).entityId,Pz=mx(dl),cz!==G&&Pz.rootActionId!==G||dn(V,dl.actionProto)||L.push(dl.key);hJ=g.WS(G,B);return g.f(D,Av(a,{mode:"readwrite",hs:!0},function(Z){var Bz=L.map(function(hg){return sx(Z,hg)});
Bz.push(sx(Z,hJ,{Vu:!0}));return g.OV.all(Bz)}),9);
case 9:if(!C){D.kf(0);break}c.reverse();if(!c.length){D.kf(0);break}tJ=g.m(c);E=tJ.next();case 12:if(E.done){D.kf(0);break}y=E.value;n=g.e9(y).entityId;if(!n){D.kf(13);break}return g.f(D,ji(n,a,V,x,H.get(n)),13);case 13:E=tJ.next(),D.kf(12)}})},yh=function(G,B,a){var V,x,h,e,w,K,l;
return g.v(function(k){if(k.j==1)return g.f(k,Av(G,{mode:"readwrite",hs:!0},function(N){var d=Qf(N,"transfer"),C=Qf(N,"offlineOrchestrationActionWrapperEntity");return g.OV.all([d,C]).then(function(z){z=g.m(z);var p=z.next().value;var O=z.next().value;z=gmC.map(function(R){return ha3(N,R)});
O=g.m(O);for(var b=O.next();!b.done;b=O.next()){b=b.value;var c=g.e9(b.actionProto.entityKey).entityType==="musicTrack",H=b.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";dn(B,b.actionProto)||c&&(!c||H)||z.push(sx(N,b.key,{Vu:!0}))}return g.OV.all(z).then(function(){return p})})}),2);
V=k.X;x=g.m(V);for(h=x.next();!h.done;h=x.next())e=h.value,CC(e),w=g.e9(e.key).entityId,K={videoId:w,offlineDeleteReason:void 0,cotn:e.cotn},ei(K),l=g.WS(w,"musicTrack"),xP(a,{entityKey:l,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.f(k,Vp2(),0)})},pd3=function(G){for(var B,a=g.m(G.additionalMetadatas),V=a.next();!V.done;V=a.next())V=V.value,V.offlineMusicVideoData&&(B=V.offlineMusicVideoData);
var x,h,e,w,K;return{id:g.WS(G.videoId,"musicTrack"),videoId:G.videoId,title:G.title,thumbnailDetails:G.thumbnail,lengthMs:String(Number(G.lengthSeconds)*1E3),albumTitle:(x=B)==null?void 0:x.releaseTitle,musicVideoType:(h=B)==null?void 0:h.musicVideoType,contentRating:{explicitType:(e=B)==null?void 0:e.explicitType},artistNames:((w=B)==null?void 0:w.byline)||((K=B)==null?void 0:K.channelName),downloadMetadata:g.WS(G.videoId,"musicTrackDownloadMetadataEntity")}},Ip2=function(G,B,a){var V,x,h,e,w,K,
l,k,N,d,C,z,p,O,b,c,H,R;
return g.v(function(q){V=[];x=new Set;if((h=a)==null?0:(e=h.downloadedTracks)==null?0:e.length)for(w=g.m(a.downloadedTracks),K=w.next();!K.done;K=w.next())l=K.value,x.add(l);if(G.tracks){k=g.m(G.tracks);for(N=k.next();!N.done;N=k.next())d=N.value,x.has(d)||V.push(d);C=g.m(B);for(z=C.next();!z.done;z=C.next())if(p=z.value,p.id!==G.id&&(O=p.tracks))for(b=g.m(O),c=b.next();!c.done;c=b.next())H=c.value,R=V.indexOf(H),R!==-1&&V.splice(R,1)}return q.return(V)})},m72=function(G,B){var a,V,x,h,e,w,K,l;
return g.v(function(k){a=zW(G.thumbnailDetails);V=g.m(B);for(x=V.next();!x.done;x=V.next())if(h=x.value,h.id!==G.id)for(e=g.m(zW(h.thumbnailDetails)),w=e.next();!w.done;w=e.next())K=w.value,l=a.indexOf(K),l!==-1&&a.splice(l,1);return k.return(a)})},U77=function(G,B){var a,V,x,h,e,w,K,l,k;
return g.v(function(N){if(N.j==1)return a=g.WS("music_downloads_library_id","musicDownloadsLibraryEntity"),g.f(N,iJ(G,a,"musicDownloadsLibraryEntity"),2);(V=N.X)||(V={id:a});x=g.e9(B).entityType;x==="musicTrack"?(h=V.downloadedTracks)!=null&&h.includes(B)||(V.downloadedTracks=((e=V.downloadedTracks)!=null?e:[]).concat(B)):x==="musicPlaylist"?(w=V.downloadedPlaylists)!=null&&w.includes(B)||(V.downloadedPlaylists=((K=V.downloadedPlaylists)!=null?K:[]).concat(B)):x!=="musicAlbumRelease"||(l=V.downloadedAlbumReleases)!=
null&&l.includes(B)||(V.downloadedAlbumReleases=((k=V.downloadedAlbumReleases)!=null?k:[]).concat(B));return g.f(N,Y6(G,V,"musicDownloadsLibraryEntity"),0)})},Ot9=function(G,B){var a,V,x,h,e,w,K;
return g.v(function(l){if(l.j==1)return a=g.WS("music_downloads_library_id","musicDownloadsLibraryEntity"),g.f(l,iJ(G,a,"musicDownloadsLibraryEntity"),2);V=l.X;if(!V)return l.kf(0);x=g.e9(B).entityType;x==="musicTrack"?h=V.downloadedTracks:x==="musicPlaylist"&&(h=V.downloadedPlaylists);if((e=h)==null?0:e.length)for(w=0;w<h.length;w++)if(K=h[w],K===B){h.splice(w,1);break}return g.f(l,Y6(G,V,"musicDownloadsLibraryEntity"),0)})},Ema=function(G){var B=G.videos;
G=[];var a=[];if(B){B=g.m(B);for(var V=B.next();!V.done;V=B.next()){var x=V.value.offlineVideoData.videoId;V=g.WS(x,"musicTrack");x=g.WS(x,"musicTrackDownloadMetadataEntity");G.push(V);a.push(x)}}return{So:G,BO:a}},cy=function(G,B,a){B={track:pd3(B)};
a&&(B.playlistId=a);if(G=g.u(G.actionMetadata,jK8))B.maximumDownloadQuality=G.maximumDownloadQuality;return{musicTrackEntityActionMetadata:B}},ycC=function(G){var B,a,V,x,h,e,w,K;
return g.v(function(l){switch(l.j){case 1:return B=g.hr(),a=yIl(G),V=g.MR(bt7),g.UA(l,2),h={rK:!0},g.f(l,g.Al(B,a,V,void 0,h),4);case 4:x=l.X;g.EA(l,3);break;case 2:e=g.jB(l);if(e instanceof g.s8)throw w="GetOffline network manager error: "+e.message,a8(w,e),Error(w);a8("GetOffline fetch request error",e);throw Error("GetOffline fetch request error");case 3:K=nC(x);if(!x)throw a8("Network request failed"),Error("Network request failed");if(K!==void 0)fC(K);else if(!x.videos||!x.videos.length)throw a8("No data"),
Error("No data");return l.return(x.videos.map(function(k){return k.offlineVideoData}))}})},ccW=function(G){var B,a,V,x,h,e,w,K;
return g.v(function(l){switch(l.j){case 1:return B=g.hr(),a=cIk(G),V=g.MR(bt7),g.UA(l,2),h={rK:!0},g.f(l,g.Al(B,a,V,void 0,h),4);case 4:x=l.X;g.EA(l,3);break;case 2:e=g.jB(l);if(e instanceof g.s8)throw w="GetOffline network manager error for playlist: "+e.message,a8(w,e),Error(w);a8("GetOffline fetch request error for playlist",e);throw Error("GetOffline fetch request error for playlist");case 3:K=nC(x);if(!x)throw a8("Network request failed for playlist"),Error("Network request failed for playlist");
if(K!==void 0)fC(K,"playlist");else if(!x.playlists||!x.playlists.length)throw a8("No data for playlist"),Error("No data for playlist");return l.return(x.playlists.map(function(k){return k.offlinePlaylistData}))}})},fpJ=function(G,B,a,V){var x,h,e,w,K,l,k,N,d,C,z,p,O,b,c,H,R,q,A,J,xB,Wz,GK,Q,M,I,L,ux,U3,dl;
return g.v(function(cz){switch(cz.j){case 1:return g.f(cz,ou(),2);case 2:x=cz.X;if(!x)return cz.return([]);h=[];if((e=V)==null?0:e.length){h=V;cz.kf(3);break}return g.f(cz,Pc(x,"mainPlaylistEntity"),4);case 4:h=cz.X;case 3:if(!h.length)return cz.return([]);w=[];K=Date.now()/1E3;l=g.m(h);k=l.next();case 5:if(k.done)return w.length?g.f(cz,nmh(w),10):cz.return([]);N=k.value;if(!N.downloadState){d=void 0;cz.kf(8);break}return g.f(cz,iJ(x,N.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:d=
cz.X;case 8:C=d;z=void 0;O=(p=(z=N)==null?void 0:z.entityMetadata)&&p.nextAutoRefreshIntervalSeconds?Number(p.nextAutoRefreshIntervalSeconds):NaN;b=Number.isNaN(O)?G:O;H=c=void 0;R=((c=C)==null?0:c.lastSyncedTimestampMillis)?Number((H=C)==null?void 0:H.lastSyncedTimestampMillis)/1E3:0;A=q=void 0;J=((q=C)==null?0:q.addedTimestampMillis)?Number((A=C)==null?void 0:A.addedTimestampMillis)/1E3:0;if(a||!p||R+b<=K){xB=[];Wz=void 0;if((Wz=N.videos)==null?0:Wz.length)for(GK=g.m(N.videos),Q=GK.next();!Q.done;Q=
GK.next())M=Q.value,I=JSON.parse(g.e9(M).entityId),I.videoId&&xB.push(I.videoId);L="0";p&&(ux=void 0,L=String(Number((ux=p.offlineLastModifiedTimestampSeconds)!=null?ux:0).toFixed()));U3={playlistId:N.playlistId,videoIds:xB,offlineLastModifiedTimestamp:L,autoSync:B,offlineDateAddedTimestamp:String(J.toFixed())};w.push(U3)}k=l.next();cz.kf(5);break;case 10:return dl=cz.X,cz.return(dl)}})},Htf=function(){var G,B,a,V,x;
return g.v(function(h){if(h.j==1)return g.f(h,ou(),2);if(h.j!=3)return(G=h.X)?g.f(h,Pc(G,"refresh"),3):h.return(!1);B=h.X;if((a=B[0])==null||!a.refreshTime)return h.return(!1);V=Number(B[0].refreshTime);x=Date.now()/1E3;return h.return(isFinite(V)&&x>=V)})},D79=function(G,B){var a,V,x;
return g.v(function(h){switch(h.j){case 1:return g.UA(h,2),g.f(h,vmJ(G,B),4);case 4:return V=h.X,g.f(h,lpC(V),5);case 5:a=Nb$(V);g.EA(h,3);break;case 2:x=g.jB(h),a8("getAndProcessSmartDownloadsResponse request or processing error",x);case 3:return h.return(a)}})},S9$=function(G,B,a,V){var x,h,e,w,K,l,k,N,d,C,z,p,O,b,c,H,R,q,A,J,xB,Wz,GK,Q,M,I,L,ux,U3,dl;
return g.v(function(cz){switch(cz.j){case 1:return g.f(cz,ou(),2);case 2:x=cz.X;if(!x)return cz.return([]);h=[];if((e=V)==null?0:e.length){h=V;cz.kf(3);break}return g.f(cz,Pc(x,"musicPlaylist"),4);case 4:h=cz.X;case 3:if(!h.length)return cz.return([]);w=[];K=Date.now()/1E3;l=g.m(h);k=l.next();case 5:if(k.done)return w.length?g.f(cz,nmh(w),10):cz.return([]);N=k.value;d=void 0;z=(C=(d=N)==null?void 0:d.entityMetadata)&&C.nextAutoRefreshIntervalSeconds?Number(C.nextAutoRefreshIntervalSeconds):NaN;p=
Number.isNaN(z)?G:z;b=O=0;c="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!N.downloadMetadata){cz.kf(8);break}return g.f(cz,iJ(x,N.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:H=cz.X,q=R=void 0,O=Number((q=(R=H)==null?void 0:R.addedTimestampMillis)!=null?q:"0")/1E3,J=A=void 0,b=Number((J=(A=H)==null?void 0:A.lastModifiedTimestampMillis)!=null?J:"0")/1E3,Wz=xB=void 0,c=(Wz=(xB=H)==null?void 0:xB.syncState)!=null?Wz:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:GK=void 0;if(a||c!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!C||Number((GK=C.lastSyncedTimestampSeconds)!=null?GK:0)+p<=K){Q=[];M=void 0;if((M=N.tracks)==null?0:M.length)for(I=g.m(N.tracks),L=I.next();!L.done;L=I.next())ux=L.value,Q.push(g.e9(ux).entityId);U3={playlistId:N.playlistId,videoIds:Q,offlineLastModifiedTimestamp:String(b.toFixed()),autoSync:B,offlineDateAddedTimestamp:String(O.toFixed())};w.push(U3)}k=l.next();cz.kf(5);break;case 10:return dl=cz.X,cz.return(dl)}})},vmJ=function(G,B){var a,V,x,h,e,w,K,l,k,N;
return g.v(function(d){switch(d.j){case 1:return a=g.hr(),g.f(d,ou(),2);case 2:V=d.X;if(!V){d.kf(3);break}return g.f(d,Ra7(V),4);case 4:x=d.X;case 3:var C=x;h={context:g.iy(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:G},offlineClientState:C,clientStateRequestData:{preferredFormatType:B}}}};e=g.MR(RO8);g.UA(d,5);K={rK:!0};return g.f(d,g.Al(a,h,e,void 0,K),7);case 7:w=d.X;g.EA(d,6);break;case 5:l=g.jB(d);if(l instanceof g.s8)throw k=
"DPS network manager error for smart downloads: "+l.message,a8(k,l),Error(k);a8("DPS fetch request error for smart downloads",l);throw Error("DPS fetch request error for smart downloads");case 6:N=nC(w);if(w)N!==void 0&&fC(N,"smart downloads");else throw a8("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return d.return(w)}})},rcC=function(G,B){var a,V,x,h,e,w,K,l;
return g.v(function(k){switch(k.j){case 1:return a=g.hr(),V={context:g.iy(),videoPlaybackPositionEntities:G,lastSyncTimestampUsec:B},x=g.MR(ZtW),g.UA(k,2),e={rK:!0},g.f(k,g.Al(a,V,x,void 0,e),4);case 4:h=k.X;g.EA(k,3);break;case 2:w=g.jB(k);if(w instanceof g.s8)throw K="VPPS network manager error: "+w.message,a8(K,w),Error(K);a8("VPPS fetch request error",w);throw Error("VPPS fetch request error");case 3:l=nC(h);if(h)l!==void 0&&fC(l,"position sync");else throw a8("Network request failed for position sync"),
Error("Network request failed for position sync");return k.return(h)}})},XdC=function(G,B,a){var V,x,h,e,w,K,l,k;
return g.v(function(N){switch(N.j){case 1:V=g.hr();var d=a.refreshData,C=a.isEnqueuedForExpiredStreamUrlRefetch,z=a.Cr,p=a.offlineSourceData,O=a.mediaCapabilities,b={entityKey:G};d&&(b.refreshData=d);C&&(b.isExpiredStreamUrlRefetch=C);z&&(b.downloadParameters=z);p&&(b.offlineSourceData=p);d={context:g.xg(B),signatureTimestamp:20152,videos:[b]};O&&(d.mediaCapabilities=O);x=d;h=g.MR($79);g.UA(N,2);w={rK:!0};return g.f(N,g.Al(V,x,h,void 0,w),4);case 4:e=N.X;g.EA(N,3);break;case 2:K=g.jB(N);if(K instanceof
g.s8)throw l="GetPDE network manager error: "+K.message,a8(l,K),Error(l);a8("GetPDE fetch request error",K);throw Error("GetPDE fetch request error");case 3:k=nC(e);if(e)k!==void 0&&fC(k,"PDE");else throw a8("Network request failed for PDE"),Error("Network request failed for PDE");return N.return(e)}})},nC=function(G){var B;
return(B=G.errorMetadata)==null?void 0:B.status},fC=function(G,B){B=B?" for "+B:"";
if(G===0)throw G="Empty response body"+B,a8(G),Error(G);G="Response with error"+B;a8(G);throw Error(G);},nmh=function(G){var B,a,V,x,h,e,w,K;
return g.v(function(l){switch(l.j){case 1:return B=g.hr(),a=nak(G),V=g.MR(q98),g.UA(l,2),h={rK:!0},g.f(l,g.Al(B,a,V,void 0,h),4);case 4:x=l.X;g.EA(l,3);break;case 2:e=g.jB(l);if(e instanceof g.s8)throw w="offlinePlaylistSyncCheck network manager error: "+e.message,a8(w,e),Error(w);a8("offlinePlaylistSyncCheck fetch request error",e);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:K=nC(x);if(!x)throw a8("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(K!==void 0)fC(K,"playlist sync");else if(!x.offlinePlaylistSyncCheckDatas||!x.offlinePlaylistSyncCheckDatas.length)throw a8("No data for playlist sync"),Error("No data for playlist sync");return l.return(x.offlinePlaylistSyncCheckDatas.map(function(k){return k.offlinePlaylistSyncCheckData}))}})},Hy=function(G){this.j=G},uja=function(G,B){var a,V,x,h,e,w;
return g.v(function(K){switch(K.j){case 1:a=new Map,V=g.m(B),x=V.next();case 2:if(x.done){K.kf(4);break}h=x.value;e=a;w=e.set;return g.f(K,G.X(h),5);case 5:w.call(e,h,K.X);x=V.next();K.kf(2);break;case 4:return K.return(a)}})},vy=function(G,B,a,V,x,h){B=g.WS(B,a);
V=Object.assign({},h,{priority:V,retryScheduleIntervalsInSeconds:x});return{actionType:G,entityKey:B,actionMetadata:V}},D6=function(G,B,a,V,x,h){this.status=G;
this.j=B;this.G=a;this.X=V;this.C=x;this.downloadState=h},QKa=function(G,B,a){this.j=G;
this.md=B;this.C=a},sKJ=function(G,B){var a,V,x,h,e,w,K,l,k;
return g.v(function(N){switch(N.j){case 1:return a=B.entityKey,x=(V=g.u(B.actionMetadata,Si))==null?void 0:V.isEnqueuedForExpiredStreamUrlRefetch,g.UA(N,2),h=void 0,g.f(N,L8C(G,B),4);case 4:h=N.X;g.UA(N,5);var d=(d=g.u(B.actionMetadata,Si))?{maximumDownloadQuality:d.maximumDownloadQuality}:void 0;return g.f(N,XdC(a,G.md,{isEnqueuedForExpiredStreamUrlRefetch:x,Cr:d,offlineSourceData:h}),7);case 7:e=N.X;g.EA(N,6,2);break;case 5:return g.jB(N,2),w=wn(B)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",a8("PDE handleAdd error"),N.return(R8(B,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",w,"DOWNLOAD_STATE_FAILED"));case 6:return g.f(N,Tb9(G,e,B),8);case 8:return N.return(R8(B,!0,e.orchestrationActions));case 2:return K=g.jB(N),l="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",K instanceof g.z0&&K.type==="QUOTA_EXCEEDED"&&(l="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
k="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),a8("PDE handleAdd error"),N.return(R8(B,!1,void 0,l,k,"DOWNLOAD_STATE_FAILED"))}})},AcW=function(G,B){var a,V,x,h,e,w,K,l,k,N,d,C,z,p,O,b,c,H,R,q,A,J,xB,Wz;
return g.v(function(GK){switch(GK.j){case 1:return a=B.entityKey,V=g.e9(a).entityId,g.f(GK,Av(G.j,{mode:"readonly",hs:!0},function(Q){var M=uJ(Q,a,"playbackData"),I=uJ(Q,g.WS(V,"offlineVideoPolicy"),"offlineVideoPolicy");Q=uJ(Q,g.WS(V,"transfer"),"transfer");return g.OV.all([M,I,Q])}),2);
case 2:x=GK.X;h=g.m(x);e=h.next().value;w=h.next().value;K=h.next().value;l=e;k=w;N=K;if(!l||!k)return GK.return(R8(B,!0));d=[];p=((z=l)==null?0:z.playerResponseJson)?JSON.parse(l.playerResponseJson):null;if(!(N&&p&&G.md.S("html5_refresh_deprecated_downloads"))){GK.kf(3);break}C=F8f(G,p,N);return g.f(GK,Jc$(G,N),4);case 4:d=GK.X;case 3:O={lastPlayerResponseTimestampSeconds:l.playerResponseTimestamp,offlineToken:k.offlineToken,formatIds:d};b={};if((c=N)==null?0:c.maximumDownloadQuality)b.maximumDownloadQuality=
N.maximumDownloadQuality;g.UA(GK,5);H=void 0;return g.f(GK,L8C(G,B),7);case 7:return H=GK.X,g.UA(GK,8),g.f(GK,XdC(a,G.md,{refreshData:O,Cr:b,offlineSourceData:H,mediaCapabilities:C}),10);case 10:R=GK.X;g.EA(GK,9,5);break;case 8:return g.jB(GK,5),q=wn(B)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",a8("PDE handleRefresh error"),GK.return(R8(B,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",q,
"DOWNLOAD_STATE_FAILED"));case 9:return g.f(GK,Tb9(G,R,B),11);case 11:return GK.return(R8(B,!0,R.orchestrationActions));case 5:return A=g.jB(GK),J="PDE handleRefresh error",A instanceof Error&&(J="PDE handleRefresh error: "+A.message),xB="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Wz="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",A instanceof g.z0&&A.type==="QUOTA_EXCEEDED"&&(xB="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Wz="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
a8(J),GK.return(R8(B,!1,void 0,xB,Wz,"DOWNLOAD_STATE_FAILED"))}})},L8C=function(G,B){var a,V,x,h;
return g.v(function(e){if(e.j==1)return a=g.e9(B.entityKey).entityId,V=g.WS(a,"videoDownloadContextEntity"),g.f(e,iJ(G.j,V,"videoDownloadContextEntity"),2);x=e.X;return(h=x)!=null&&h.offlineModeType?e.return({offlineModeType:x.offlineModeType}):e.return(void 0)})},Tb9=function(G,B,a){var V,x,h,e,w;
return g.v(function(K){if(K.j==1){if(!B.frameworkUpdates||!g.u(B.frameworkUpdates,OS))return K.return();if(!(g.u(B.frameworkUpdates,OS).mutations&&g.u(B.frameworkUpdates,OS).mutations.length>0&&g.u(B.frameworkUpdates,OS).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return K.kf(2);V=g.e9(g.u(B.frameworkUpdates,OS).mutations[0].entityKey).entityId;return g.f(K,ES(G.j,V),3)}if(K.j!=2){x=K.X;h=g.u(a.actionMetadata,Si);if(w=(e=h)==null?void 0:e.playlistId)x.playlistId=w;x.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.YF(G.md)?g.f(K,US(V,G.j,a,G.C,x),2):g.rv(G.md)?g.f(K,ji(V,G.j,a,G.C),2):K.kf(2)}return g.f(K,IcJ(g.u(B.frameworkUpdates,OS)),0)})},R8=function(G,B,a,V,x,h){return new D6(B?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",wn(G),a,V,x,h)},F8f=function(G,B,a){B=Bbh(G.md,a.cotn,B);
a=g.WF(B);return g.qix(B,a,G.md)},Jc$=function(G,B){var a,V,x,h,e,w,K,l,k,N,d;
return g.v(function(C){if(C.j==1)return a=[],g.f(C,Av(G.j,{mode:"readonly",hs:!0},function(z){var p=[],O=B.offlineVideoStreams;if(O){O=g.m(O);for(var b=O.next();!b.done;b=O.next())p.push(uJ(z,b.value,"offlineVideoStreams"))}return g.OV.all(p)}),2);
if(V=C.X)for(x=g.m(V),h=x.next();!h.done;h=x.next())if(e=h.value,w=void 0,(w=e)==null?0:w.streamsProgress)for(K=e.streamsProgress,l=0;l<K.length;l++)k=K[l],N=JSON.parse(k.formatStreamBytes),d={itag:N.itag,lmt:N.lastModified,xtags:N.xtags},a.push(d);return C.return(a)})},Y97=function(G,B){this.j=G;
this.md=B},ita=function(G,B){var a,V,x,h,e,w,K,l,k,N,d,C;
return g.v(function(z){switch(z.j){case 1:return a=wn(B),g.f(z,Pc(G.j,"videoPlaybackPositionEntity"),2);case 2:V=z.X;if(V.length===0)return z.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a));g.UA(z,3);return g.f(z,$6.getInstance(),5);case 5:x=z.X;if(!x)throw Error("prefStorage is undefined");return g.f(z,x.get("psi"),6);case 6:return h=z.X,K=(w=(e=h)==null?void 0:e.Gl)!=null?w:"0",g.f(z,rcC(V,K),7);case 7:return l=z.X,k={isPaused:l.watchHistoryPaused,Gl:l.syncTimestampUsec},g.f(z,x.set("psi",
k),8);case 8:if(k.isPaused){z.kf(9);break}N=g.u(l.frameworkUpdates,OS);if(!l.frameworkUpdates||!N){z.kf(9);break}return g.f(z,IcJ(N),9);case 9:g.EA(z,4);break;case 3:return d=g.jB(z),C="PPE handleRefresh error: "+(d instanceof Error?d.message:"unknown error"),a8(C),z.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return z.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
a))}})},omC=function(G,B){var a,V,x,h,e,w,K,l;
return g.v(function(k){switch(k.j){case 1:return a=wn(B),V=g.e9(B.entityKey).entityId,g.UA(k,2),g.f(k,$6.getInstance(),4);case 4:x=k.X;if(!x)throw Error("prefStorage is undefined");return g.f(k,x.get("psi"),5);case 5:h=k.X;e=g.u(B.actionMetadata,PGa);if(((w=h)==null?void 0:w.isPaused)!==!1||(K=e)==null||!K.lastPlaybackPositionSeconds){k.kf(6);break}l={key:g.WS(V,"videoPlaybackPositionEntity"),videoId:V,lastPlaybackPositionSeconds:e.lastPlaybackPositionSeconds};return g.f(k,Y6(G.j,l,"videoPlaybackPositionEntity"),
6);case 6:g.EA(k,3);break;case 2:return g.jB(k),k.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return k.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a))}})},Mp2=function(G,B){var a,V,x;
return g.v(function(h){switch(h.j){case 1:a=wn(B);g.UA(h,2);V=g.e9(B.entityKey).entityId;if(V==="!*$_ALL_ENTITIES_!*$")return g.f(h,dV7(G.j),5);x=g.WS(V,"videoPlaybackPositionEntity");return g.f(h,Nxa(G.j,x),5);case 5:g.EA(h,3);break;case 2:return g.jB(h),h.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return h.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
a))}})},G32=function(G,B){this.api=G;
this.j=B;this.logger=new g.xY("woffle");this.X=!1;this.vC={Ia:this.Ia};this.logger.debug("Initialized OfflineMediaManager")},BAf=function(G){return g.v(function(B){return B.return(b4s(G))})},aqC=function(G){var B;
return g.v(function(a){if(a.j==1)return g.f(a,g.NmV(G),2);B=a.X;return a.return(B.filter(function(V){return!!V.url}).map(function(V){return V.url}))})},Z6=function(G,B){var a=g.n$(B);
if(a===1||a===0)return Promise.resolve();(a=V6l(G,B))&&a.stopVideo();G.C=0;return BAf(B)},rn=function(G,B,a,V){a=a===void 0?!1:a;
V=V===void 0?!0:V;var x=typeof B==="string"?B:B.videoDetails.videoId;g.n$(x)===2&&((B=V6l(G,x))?B.stopVideo():G.logger.info(function(){return"Corresponding player for "+x+" not found. Pausing anyway"}),g.f$(x,2),G.C=2,a?x1f(G.j):V&&hm7(G.j))},V6l=function(G,B){var a;
return((a=G.player)==null?void 0:a.getVideoData().videoId)===B?G.player:null},em7=function(G,B,a){B.getPlayerResponse();
g.f$(B.videoId,2);G.C=2;G.X=!1;var V;(V=G.player)==null||V.dispose();G.player=G.api.rA(B);B={};G.player.dV((B.localmediachange=G.Jj,B.signatureexpired=G.dl,B.statechange=G.Odx,B),G);var x=G.Ia(a);G.player.MY(g.a1(x,x,!0,"m"),!1);G.logger.debug(function(){return"Starting headless playback with quality: "+x});
G.player.iq(!1)},WK3=function(G,B){this.j=G;
this.md=B},KKs=function(G,B){var a,V;
return g.v(function(x){switch(x.j){case 1:return a=wn(B),g.f(x,iJ(G.j,B.entityKey,"transfer"),2);case 2:if(V=x.X)return x.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a));g.UA(x,3);return g.f(x,wG8(G,B),5);case 5:g.EA(x,4);break;case 3:return g.jB(x),x.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return x.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
a))}})},lqs=function(G,B){var a,V;
return g.v(function(x){switch(x.j){case 1:return a=wn(B),g.f(x,iJ(G.j,B.entityKey,"transfer"),2);case 2:V=x.X;if(!V||V.transferState!=="TRANSFER_STATE_COMPLETE")return x.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a));g.UA(x,3);return g.f(x,wG8(G,B,!0),5);case 5:g.EA(x,4);break;case 3:return g.jB(x),x.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return x.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a))}})},k3l=function(G,B){var a,V,x,h,e,w,K,l,k,N;
return g.v(function(d){switch(d.j){case 1:return a=wn(B),V=g.e9(B.entityKey).entityId,g.f(d,Av(G.j,{mode:"readonly",hs:!0},function(C){var z=uJ(C,B.entityKey,"transfer");C=uJ(C,g.WS(V,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.OV.all([z,C])}),2);
case 2:x=d.X;h=g.m(x);e=h.next().value;w=h.next().value;K=e;l=w;if(!K||K.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return d.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a));g.UA(d,3);K.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.f(d,Y6(G.j,K,"transfer"),5);case 5:k=g.e9(K.key).entityId;Wy({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:k,oe:K,offlineModeType:(N=l)==null?void 0:N.offlineModeType});g.EA(d,
4);break;case 3:return g.jB(d),d.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return d.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a))}})},wG8=function(G,B,a){a=a===void 0?!1:a;
var V,x,h,e,w,K,l,k,N,d,C,z,p,O,b;return g.v(function(c){switch(c.j){case 1:return V=g.u(B.actionMetadata,NAC),x=g.e9(B.entityKey).entityId,h=g.WS(x,"downloadStatusEntity"),g.f(c,Av(G.j,{mode:"readonly",hs:!0},function(H){var R=uJ(H,h,"downloadStatusEntity");H=uJ(H,g.WS(x,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.OV.all([R,H])}),2);
case 2:return e=c.X,w=g.m(e),K=w.next().value,l=w.next().value,k=K,N=l,d="TRANSFER_STATE_TRANSFER_IN_QUEUE",((C=k)==null?void 0:C.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(d="TRANSFER_STATE_PAUSED_BY_USER"),O={key:B.entityKey,transferState:d,cotn:g.Et(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(z=V)==null?void 0:z.maximumDownloadQuality,preferredAudioTrack:(p=V)==null?void 0:p.preferredAudioTrack,transferRetryCount:0,isRefresh:a,hasLoggedFirstStarted:!1},g.f(c,Av(G.j,
{mode:"readwrite",hs:!0},function(H){var R=[];a&&R.push(sx(H,g.WS(x,"offlineVideoStreams")));R.push(Tr(H,O,"transfer"));return g.OV.all(R)}),3);
case 3:if(!a){c.kf(4);break}return g.f(c,BAf(x),4);case 4:Wy({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:x,oe:O,offlineModeType:(b=N)==null?void 0:b.offlineModeType}),g.pV(c)}})},CCC=function(G,B,a,V){if(!G.action.entityKey)throw Error("entityKey is missing.");
var x=g.e9(G.action.entityKey);x={entityType:x.ZJ,entityId:x.entityId,offlineOrchestrationActionType:G.action.actionType,orchestrationAction:{orchestrationActionId:G.actionId}};B&&(x.offlineOrchestrationActionResult=B.status,x.isRetryable=a?!1:B.j,B.C&&(x.offlineOrchestrationFailureReason=d1C(B.C,x.isRetryable)));var h,e;if((h=G.action.actionMetadata)==null?0:(e=h.offlineLoggingData)==null?0:e.offlineModeType)x.offlineModeType=G.action.actionMetadata.offlineLoggingData.offlineModeType;V&&(x.additionalOrchestrationActions=
V.map(function(w){return{orchestrationActionId:w.actionId}}));
return x},d1C=function(G,B){return G!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||B?G==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&B?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":G:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},zml=function(G,B){var a={offlineOrchestrationContext:CCC(G)};
B=DV9(B,a);SK2(vaC(),B,G.rootActionId)},t62=function(G,B,a,V){V=V===void 0?[]:V;
B={offlineOrchestrationContext:CCC(G,B,a,V)};B=DV9(3,B);SK2(vaC(),B,G.rootActionId)},m1f=function(){this.actions=[]},Iqk=function(G,B){B=g.m(B);
for(var a=B.next();!a.done;a=B.next())a=a.value,zml(a,1),G.actions.push(a);G.actions.sort(G.j)},g0h=function(G,B){if(B)for(var a=0;a<G.actions.length;a++)if(B==="!*$_ALL_ENTITIES_!*$"&&G.actions[a].actionId!==B||B!=="!*$_ALL_ENTITIES_!*$"&&G.actions[a].rootActionId===B&&G.actions[a].actionId!==B)G.actions.splice(a,1),a--},pG8=function(G,B){G=g.m(G.actions);
for(var a=G.next();!a.done;a=G.next())if(a.value.actionId===B)return!0;return!1},$P=function(G,B,a,V,x){g.r.call(this);
var h=this;this.X=G;this.HS=B;this.zH=a;this.W=V;this.md=x;this.j=new m1f;this.L=new g.Ad;this.C=new g.J8(function(){h.retry()});
this.V=NaN;this.B=!1;this.vC={dwN:function(){return h.j},
Hu:function(){return h.L},
fIN:function(){return h.C},
retry:function(){return h.retry()}};
g.X(this,this.C);this.Y=this.X.observe(this.XJ.bind(this))},E0h=function(G,B,a,V,x){var h;
return g.v(function(e){if(e.j==1)return h=new $P(G,B,a,V,x),g.f(e,U19(h),2);OyW(h);return e.return(h)})},OyW=function(G){var B=G.j.actions[0];
return G.G?((B==null?void 0:B.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&G.G[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(G.B=!0),Promise.resolve()):jX2(G)},jX2=function(G){var B,a,V,x,h,e,w,K,l,k,N,d,C,z,p,O,b;
return g.v(function(c){switch(c.j){case 1:if(G.G)throw Error("Already processing an action");if(G.TH())return c.return();B=G.j.actions.shift();JI$(G.zH,!B);if(B===void 0)return c.return();B.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&B.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&g0h(G.j,B.actionId);a="";B.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&B.rootActionId===B.actionId&&(a=B.actionId);V=[B];G.G=V;if(x=G.HS[B.entityType]){c.kf(2);break}G.G=
void 0;return g.f(c,jX2(G),3);case 3:return c.return();case 2:h=g.m(V);for(e=h.next();!e.done;e=h.next())w=e.value,zml(w,2);g.UA(c,4,5);return g.f(c,uja(x,V.map(function(H){return H.action})),7);
case 7:K=c.X,l=g.m(V),k=l.next();case 8:if(k.done){c.kf(10);break}N=k.value;d=K.get(N.action);return g.f(c,byW(G,N,d),9);case 9:k=l.next();c.kf(8);break;case 10:g0h(G.j,a);case 5:g.bx(c);G.G=void 0;g.yb(c,6);break;case 4:return C=g.jB(c),a8("Orchestration error",C),g.UA(c,12),g.f(c,y83(G,V),14);case 14:g.EA(c,5);break;case 12:z=g.jB(c);a8("Orchestration retry error",z);p=g.m(V);for(O=p.next();!O.done;O=p.next())b=O.value,b.retryScheduleIndex<3&&Iqk(G.j,[b]);c.kf(5);break;case 6:return g.f(c,jX2(G),
0)}})},byW=function(G,B,a){var V,x,h,e,w,K,l,k,N,d,C,z;
return g.v(function(p){switch(p.j){case 1:V=B.retryScheduleIndex+2===3;if(a.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){p.kf(2);break}if(a.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){p.kf(0);break}t62(B,a,V);if(a.j&&B.retryScheduleIndex+1<3)return g.f(p,y83(G,[B]),0);h=((x=a)==null?0:x.X)?a.X:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";e={entityKey:B.action.entityKey,failureReason:h};w=void 0;g.YF(G.md)?w="mainVideoDownloadStateEntity":g.rv(G.md)&&(w="musicTrackDownloadMetadataEntity");
if(!w||!a.downloadState){p.kf(7);break}K=g.e9(B.action.entityKey).entityId;return g.f(p,Ni(K,w,G.X,a.downloadState),7);case 7:xP(G.W,e);if(a.downloadState==="DOWNLOAD_STATE_FAILED"&&G.md.S("html5_auto_retry_failed_pde_actions")){p.kf(0);break}a8("Orchestration result is not retryable, deleting action");return g.f(p,Nxa(G.X,I8(B).key),0);case 2:l=void 0;try{l=(k=a.G)==null?void 0:k.map(function(O){return G.createAction(O,B)})}catch(O){return t62(B,a,V),N={entityKey:B.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},xP(G.W,N),a8("Orchestration subactions creation error",O),p.return()}t62(B,a,V,l);if(!l){p.kf(12);break}d=l.map(function(O){return I8(O)});
C=0;case 13:if(!(C<l.length)||G.B){p.kf(15);break}return g.f(p,Av(G.X,{mode:"readwrite",hs:!0},function(O){var b=[];b.push(ac2(O,d.slice(C,C+10),"offlineOrchestrationActionWrapperEntity"));return g.OV.all(b)}),16);
case 16:C+=10;p.kf(13);break;case 15:if(G.B)return G.B=!1,p.return();case 12:return z=I8(B),g.f(p,Nxa(G.X,z.key),17);case 17:zml(B,4),g.pV(p)}})},Hyf=function(G,B){var a,V,x,h,e,w,K,l,k,N,d,C;
return g.v(function(z){a=[];V=Infinity;x=4E3;h=g.m(B);for(e=h.next();!e.done;e=h.next())w=e.value,K=Number(w.enqueueTimeSec),l=c87(K),k=w.retryScheduleIndex,N=k!=null&&k>0,l>0&&N?(V=Math.min(V,K),x=Math.min(l,x)):a.push(w);isFinite(V)&&(!G.C.isActive()||V<G.V)&&(G.V=V,G.C.start(x));G.L.JA()||(d=a.length,a=a.filter(function(p){var O;p=((O=p.actionProto)==null?void 0:O.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!n0a.includes(p)}),C=a.length<d,!G.C.isActive()&&C&&G.C.start(1));
a.length>0&&fq3(G,a);return g.f(z,OyW(G),0)})},D1s=function(G){var B,a,V,x,h,e,w;
return g.v(function(K){if(K.j==1)return g.f(K,v08(G),2);B=K.X;a=[];V=g.m(B);for(x=V.next();!x.done;x=V.next())h=x.value,e=g.e9(h.key),w=e.entityId,pG8(G.j,w)||a.push(h);return g.f(K,Hyf(G,a),0)})},c87=function(G){G=G*1E3-Date.now();
return G>4E3?4E3:G},y83=function(G,B){var a,V,x;
return g.v(function(h){a=g.m(B);for(V=a.next();!V.done;V=a.next()){x=V.value;var e=void 0,w=void 0,K=((w=x.action)==null?void 0:(e=w.actionMetadata)==null?void 0:e.retryScheduleIntervalsInSeconds)||[1,2,4];e=1;x.retryScheduleIndex<K.length&&(e=K[x.retryScheduleIndex]);x.j=e*1E3+Date.now();x.retryScheduleIndex++}return g.f(h,Sr7(G,B),0)})},U19=function(G){var B;
return g.v(function(a){if(a.j==1)return g.f(a,Pc(G.X,"offlineOrchestrationActionWrapperEntity"),2);B=a.X;return g.f(a,Hyf(G,B),0)})},fq3=function(G,B){B.length!==0&&B.forEach(function(a){a=mx(a);
a.retryScheduleIndex<3&&Iqk(G.j,[a])})},v08=function(G,B){var a;
return g.v(function(V){if(V.j==1)return g.f(V,Pc(G.X,"offlineOrchestrationActionWrapperEntity",B),2);a=V.X;return V.return(a.filter(gaC))})},Sr7=function(G,B){if(B.length===0)return Promise.resolve([]);
B=B.map(function(a){return I8(a)});
return kdf(G.X,B)},Rmk=function(G){this.JX=G;
this.j=void 0},Zy7=function(G,B){var a,V,x,h;
return g.v(function(e){a=B.videoId;V=!0;if(B.captionTracks.length)x=GU8(B),G.j=new g.Op(G.JX,B,x);else if(B.xF)h=g.Ucg(B),G.j=new g.jA(G.JX,B.xF,a,h,B.bF,B.eventId),V=B.bF;else return e.return();return e.return(new Promise(function(w){var K;(K=G.j)==null||K.Fp({gJ:function(){return g.v(function(l){if(l.j==1)return g.f(l,G.gJ(a,V),2);w();g.pV(l)})},
yR:function(){}})}))})},r8s=function(G){var B;
return g.v(function(a){if(a.j==1)return g.f(a,jqW(G),2);B=a.X;return a.return(!!B&&B.length>0)})},Xl=function(G){g.r.call(this);
this.j=G;this.X=this.j.observe(this.C.bind(this))},$12=function(G,B){var a,V,x,h,e,w,K;
return g.v(function(l){switch(l.j){case 1:if(B.length===0)return l.return([]);a=B.map(function(k){return g.WS(k,"transfer")});
return g.f(l,Pc(G.j,"transfer",a),2);case 2:V=l.X;x=V.filter(gaC).map(function(k){return g.e9(k.key).entityId});
h=B.filter(function(k){return x.indexOf(k)===-1});
if(h.length===0)return l.return([]);e=g.m(h);w=e.next();case 3:if(w.done){l.kf(5);break}K=w.value;return g.f(l,BAf(K),4);case 4:w=e.next();l.kf(3);break;case 5:return l.return(h)}})},u7s=function(G,B,a,V,x,h){var e,w,K;
return g.v(function(l){e="STREAM_TYPE_UNKNOWN";a.video&&a.audio?(e="STREAM_TYPE_AUDIO_AND_VIDEO",a8("unexpected stream type")):a.video&&!a.audio?e="STREAM_TYPE_VIDEO":!a.video&&a.audio&&(e="STREAM_TYPE_AUDIO");w=g.WS(B,"offlineVideoStreams");K={numBytesDownloaded:x.toFixed(),numTotalBytes:h.toFixed(),streamType:e,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(V),itag:e==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(a.itag):void 0};return g.f(l,Av(G,{mode:"readwrite",hs:!0},
function(k){var N=uJ(k,w,"offlineVideoStreams"),d=uJ(k,g.WS(B,"transfer"),"transfer");return g.OV.all([N,d]).then(function(C){C=g.m(C);var z=C.next().value;C=C.next().value;if(!C)return sx(k,w).then(function(){});
var p=XGf(z);z=qr3(z,V,K,w);var O=Tr(k,z,"offlineVideoStreams");XGf(z)>p&&(C.lastProgressTimeMs=Date.now().toString());p=[O];C.offlineVideoStreams||(C.offlineVideoStreams=[]);C.offlineVideoStreams.indexOf(w)===-1&&(C.offlineVideoStreams.push(w),p.push(Tr(k,C,"transfer")));return g.OV.all(p)})}),0)})},QX7=function(G,B){var a,V,x,h,e;
return g.v(function(w){if(w.j==1)return a=g.WS(B,"offlineVideoStreams"),g.f(w,iJ(G,a,"offlineVideoStreams"),2);V=w.X;if(!V||!V.streamsProgress)return w.return();x=g.m(V.streamsProgress);for(h=x.next();!h.done;h=x.next())e=h.value,e.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",e.numTotalBytes!==e.numBytesDownloaded&&(e.numBytesDownloaded=e.numTotalBytes);return g.f(w,Y6(G,V,"offlineVideoStreams"),0)})},qr3=function(G,B,a,V){if(G&&G.streamsProgress){V=G;
a:{B=B.itag+";"+B.xtags;for(var x=G.streamsProgress,h=0;h<x.length;h++){var e=JSON.parse(x[h].formatStreamBytes);if(e.itag+";"+e.xtags===B){x[h]=a;a=x;break a}}x.push(a);a=x}V.streamsProgress=a}else G={key:V,streamsProgress:[a]};return G},XGf=function(G){if(G==null?0:G.streamsProgress){var B=0;
G=G.streamsProgress;for(var a=0;a<G.length;a++){var V=G[a];isNaN(Number(V.numBytesDownloaded))?a8("stream progress bytes number invalid"):B+=Number(V.numBytesDownloaded)}return B}return 0},LKf=function(G,B,a,V){g.r.call(this);
var x=this;this.X=G;this.api=B;this.qB=a;this.XJ=V;this.L=new g.Ad;this.G=new g.J8(function(){x.j&&x.j.transferState==="TRANSFER_STATE_TRANSFERRING"&&x.L.JA()&&((x.j.transferRetryCount||0)<3?rn(x.W,x.B,!1,!1):Z6(x.W,x.B.videoDetails.videoId),x.q1("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.zH=this.Zx=0;this.Y=this.V=!1;this.Er=g.kf(this.api.U().experiments,"html5_transfer_processing_logs_interval");this.SJ=new g.Zh(this);this.vC={BKn:function(){return x.G},
XoH:function(){return x.XJ},
Hu:function(){return x.L}};
this.HS=this.X.observe(this.EV.bind(this));this.W=new G32(B,this);this.Ur=new Rmk(B);this.GH=new Xl(this.X);this.Qb=this.L.listen("publicytnetworkstatus-online",this.A5.bind(this));this.LN=this.L.listen("publicytnetworkstatus-offline",this.Ncl.bind(this));this.Y=this.api.U().S("html5_less_transfer_processing_logs");g.X(this,this.SJ);this.SJ.K(B,"offlinetransferpause",this.YvN);g.YF(this.api.U())?this.C="mainVideoDownloadStateEntity":g.rv(this.api.U())&&(this.C="musicTrackDownloadMetadataEntity")},
TA8=function(G){return g.v(function(B){if(B.j==1)B=g.f(B,O42(),2);
else{var a=G.GH;var V=g.c_();V=Object.keys(V);a=$12(a,V);B=g.f(B,a,0)}return B})},uZ=function(G,B){B=B===void 0?!1:B;
var a;return g.v(function(V){if(V.j==1){if(G.j)throw Error("Already downloading a video");G.zH=0;G.V=!1;return g.f(V,sX3(G),2)}return V.j!=4?(a=V.X,AIC(G.qB,!a),a&&G.L.JA()?B?g.f(V,new Promise(function(x){g.z9(x,1E3)}),4):V.kf(4):(!a&&G.j&&qi(G),V.kf(0))):g.f(V,FK2(G,a),0)})},J8k=function(G){return g.v(function(B){if(B.j==1)return G.B?g.f(B,Z6(G.W,G.B.videoDetails.videoId),3):B.kf(0);
qi(G);g.pV(B)})},A8f=function(G,B){var a,V,x;
return g.v(function(h){switch(h.j){case 1:return g.UA(h,2),(a=!!B.captionTracks.length||!!B.xF)?g.f(h,r8s(B.videoId),4):h.return();case 4:return(V=h.X)?h.return():g.f(h,Zy7(G.Ur,B),5);case 5:g.EA(h,0);break;case 2:x=g.jB(h),a8("Caption downloading error",x,B.cotn),g.pV(h)}})},FK2=function(G,B){var a,V,x,h,e,w;
return g.v(function(K){switch(K.j){case 1:if(G.V)return K.return();G.V=!0;G.j=B;a=g.e9(G.j.key);V=a.entityId;x=void 0;if(G.j.transferState==="TRANSFER_STATE_TRANSFERRING")return g.f(K,Qh(G,V),7);if(G.j.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||G.j.transferRetryCount||G.j.hasLoggedFirstStarted){K.kf(3);break}return g.f(K,Qh(G,V),5);case 5:return x=K.X,G.j.hasLoggedFirstStarted=!0,g.f(K,Yrl(G),6);case 6:YKk({videoId:V,oe:G.j,offlineModeType:x},void 0,void 0,!0);K.kf(3);break;case 7:x=K.X,
Wy({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:V,oe:G.j,offlineModeType:x});case 3:return g.f(K,iy9(G),8);case 8:return h=null,g.UA(K,9),g.f(K,PCC(G,B),11);case 11:h=K.X;G.B=h;g.EA(K,10);break;case 9:return e=g.jB(K),a8("error getting player response",e,B.cotn),g.f(K,G.q1("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return K.return();case 10:return w=Bbh(G.api.U(),B.cotn,h),g.f(K,A8f(G,w),13);case 13:return g.f(K,aqC(w.videoId),
14);case 14:w.Xo=K.X,em7(G.W,w,B.maximumDownloadQuality),G.G.start(108E5),g.pV(K)}})},sX3=function(G){var B,a;
return g.v(function(V){if(V.j==1)return g.f(V,Pc(G.X,"transfer"),2);B=V.X;a=B.filter(o0J).sort(M6f);return a.length===0?V.return():V.return(a[0])})},iy9=function(G){var B,a,V;
return g.v(function(x){if(x.j==1){if(!G.j)return LC(G,"onTransferStart"),x.return();G.G.start(108E5);return g.f(x,TW(G,"TRANSFER_STATE_TRANSFERRING"),2)}B=G.j;return(V=((a=B)==null?0:a.key)?g.e9(B.key).entityId:"")&&G.C?g.f(x,Ni(V,G.C,G.X,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):x.kf(0)})},x1f=function(G){var B,a,V,x;
g.v(function(h){switch(h.j){case 1:if(!G.j){LC(G,"onTransferPausedByUser");h.kf(2);break}B=G.j;G.G.stop();return g.f(h,TW(G,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:V=((a=B)==null?0:a.key)?g.e9(B.key).entityId:"";if(!V||!G.C){h.kf(4);break}return g.f(h,Ni(V,G.C,G.X,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.f(h,Qh(G,V),6);case 6:x=h.X,i4f({videoId:V,oe:B,offlineModeType:x});case 2:qi(G),uZ(G),g.pV(h)}})},hm7=function(G){var B,a,V;
g.v(function(x){if(x.j==1){if(!G.j)return LC(G,"onTransferPausedByNetwork"),x.return();G.G.stop();return g.f(x,TW(G,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(x.j!=3)return B=G.j,(V=((a=B)==null?0:a.key)?g.e9(B.key).entityId:"")&&G.C?g.f(x,Ni(V,G.C,G.X,"DOWNLOAD_STATE_PAUSED"),3):x.kf(3);qi(G);g.pV(x)})},GV9=function(G){var B,a,V,x,h;
g.v(function(e){switch(e.j){case 1:if(!G.j)return LC(G,"onTransferComplete"),e.return();B=G.j;G.G.stop();if(!B||!G.B){e.kf(2);break}a=Bbh(G.api.U(),B.cotn,G.B);return g.f(e,A8f(G,a),2);case 2:return g.f(e,TW(G,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:x=((V=B)==null?0:V.key)?g.e9(B.key).entityId:"";if(!x||!G.C){e.kf(5);break}return g.f(e,Ni(x,G.C,G.X,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.f(e,QX7(G.X,x),7);case 7:return g.f(e,Qh(G,x),8);case 8:h=e.X,Wy({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:x,oe:B,offlineModeType:h}),qi(G),uZ(G),g.pV(e)}})},Bil=function(G,B,a){var V,x;
g.v(function(h){switch(h.j){case 1:if(!G.j)return LC(G,"onTransferProgress: "+B),h.return();if(G.j.transferState==="TRANSFER_STATE_TRANSFERRING"){h.kf(2);break}return g.f(h,iy9(G),2);case 2:V=Date.now();if(!(V-G.Zx>1E3)){h.kf(4);break}G.Zx=V;return g.f(h,u7s(G.X,a.videoId,a.X,a.B1,a.bytesDownloaded,a.j),5);case 5:if(G.Y&&!(G.Y&&V-G.zH>G.Er)){h.kf(4);break}G.zH=V;return g.f(h,Qh(G,B),7);case 7:x=h.X,YKk({videoId:B,oe:G.j,offlineModeType:x},a.bytesDownloaded,a.j);case 4:G.G.start(108E5),g.pV(h)}})},
aA3=function(G){var B=(G.j.transferRetryCount||0)<3;
B&&(G=G.j,G.transferRetryCount=(G.transferRetryCount||0)+1);return B},Vbh=function(G,B){B=B===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":B;
var a,V,x,h;return g.v(function(e){if(e.j==1)return G.j||LC(G,"setTransferToFailed: "+B),a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",B==="TRANSFER_FAILURE_REASON_NETWORK"?a="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":B==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.f(e,TW(G,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",B),2);if(e.j!=3)return xP(G.XJ,{entityKey:(V=G.j)==null?void 0:V.key,failureReason:a}),
x=G.j?g.e9(G.j.key).entityId:"",g.f(e,Qh(G,x),3);h=e.X;var w={videoId:x,oe:G.j,offlineModeType:h},K=B,l={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};K&&(l.transferFailureReason=K,l.failureReason=PLl(K));Wy(l,w);g.pV(e)})},TW=function(G,B,a,V){var x;
return g.v(function(h){if(h.j==1){if(!G.j)return LC(G,"saveTransferState: "+B),h.return();G.j.transferState=B;G.j.failureReason=V;g.UA(h,2);return g.f(h,Yrl(G,function(e){return a?Qf(e,"offlineVideoStreams",G.j.offlineVideoStreams).then(function(w){for(var K=g.m(w),l=K.next();!l.done;l=K.next())if((l=l.value)&&l.streamsProgress){l=g.m(l.streamsProgress);for(var k=l.next();!k.done;k=l.next())k.value.streamState=a}return ac2(e,w.filter(function(N){return!!N}),"offlineVideoStreams")}):g.OV.resolve(void 0)}),
4)}if(h.j!=2)return g.EA(h,0);
x=g.jB(h);return x instanceof g.z0&&x.type==="QUOTA_EXCEEDED"?g.f(h,G.q1("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):h.kf(0)})},Yrl=function(G,B){var a;
return g.v(function(V){if(!G.j)return V.return();a=G.j;return g.f(V,Av(G.X,{mode:"readwrite",hs:!0},function(x){var h=[Tr(x,a,"transfer")];B&&h.push(B(x));return g.OV.all(h)}),0)})},qi=function(G){G.j=void 0;
G.B=void 0;G.G.stop()},PCC=function(G,B){var a,V,x,h,e;
return g.v(function(w){if(w.j==1)return a=g.e9(B.key),V=a.entityId,x=g.WS(V,"playbackData"),g.f(w,iJ(G.X,x,"playbackData"),2);h=w.X;if((e=h)==null?0:e.playerResponseJson)return w.return(JSON.parse(h.playerResponseJson));throw Error("No PlayerResponse found");})},LC=function(G,B){G.api.FJ("woffle",{mcte:B});
a8("missing current transfer entity.")},Qh=function(G,B){var a,V,x;
return g.v(function(h){if(h.j==1)return g.f(h,iJ(G.X,g.WS(B,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);a=h.X;return h.return((x=(V=a)==null?void 0:V.offlineModeType)!=null?x:void 0)})},o0J=function(G){return x4k[G.transferState]!==void 0},M6f=function(G,B){var a=x4k[G.transferState],V=x4k[B.transferState];
return a!==V?a-V:Number(G.enqueuedTimestampMs)-Number(B.enqueuedTimestampMs)},sS=function(G,B){var a=this;
this.md=G;this.api=B;this.L=new g.Ad;this.B=new g.z_;this.vC={rI:function(){return a.C.vC.rI()},
Hu:function(){return a.L},
CIS:function(){return a.C},
Nz:function(){return a.Nz()},
R5:function(){return a.R5()},
ZN:function(){return a.ZN()},
S5:function(){return a.S5()},
Lq:function(){return a.Lq()},
oh:function(V){return a.oh(V)}};
this.C=new Txs(function(){return hRk(a)},function(){a.ZN()},this.api.xT(),this.api.S.bind(this.api));
this.j=new Vh(this.api);sqf(this.C)},hRk=function(G){return g.v(function(B){G.api.pN("onOrchestrationBecameLeader");
return g.f(B,G.R5(),0)})},WuW=function(G){var B,a;
return g.v(function(V){if(V.j==1)return g.f(V,ou(),2);if(V.j!=3){B=V.X;if(!B)return a8("PES is undefined"),V.return();G.X=new LKf(B,G.api,G.C,G.j);a=G.VQ(B);return g.f(V,E0h(B,a,G.C,G.j,G.md),3)}G.W=V.X;return g.f(V,eRW(G),0)})},eRW=function(G){var B;
return g.v(function(a){switch(a.j){case 1:if(!G.X)return a8("transferManager is undefined"),a.return();if(G.X.j){a.kf(2);break}return g.f(a,uZ(G.X),2);case 2:if(!G.md.S("woffle_enable_main_downloads_library")){a.kf(4);break}return g.f(a,G.bS(),4);case 4:if(!G.md.S("html5_offline_playback_position_sync")){a.kf(6);break}return g.f(a,G.WW(),7);case 7:return g.f(a,G.oh(864E5),6);case 6:return g.f(a,G.refreshAllStaleEntities(43200,!0),9);case 9:return g.f(a,G.L0(),10);case 10:if(!G.md.S("html5_retry_downloads_for_expiration")){a.kf(11);
break}return g.f(a,G.Lq(),11);case 11:return G.V=g.tM(function(){G.refreshAllStaleEntities(43200,!0);G.L0()},9E5),g.PH(g.Me(),function(){return G.S5()}),g.f(a,ou(),13);
case 13:return B=a.X,g.f(a,LlC(B),14);case 14:Fla(G.C),g.pV(a)}})},wCJ=function(){var G,B,a,V,x,h;
return g.v(function(e){switch(e.j){case 1:return g.f(e,ou(),2);case 2:G=e.X;if(!G)return e.return([]);B=Date.now()/1E3;return g.f(e,Pc(G,"offlineVideoPolicy"),3);case 3:a=e.X,V=g.m(a),x=V.next();case 4:if(x.done){e.kf(6);break}h=x.value;if(!(h.expirationTimestamp&&Number(h.expirationTimestamp)<B)){e.kf(5);break}h.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";h.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.f(e,Y6(G,h,"offlineVideoPolicy"),5);
case 5:x=V.next();e.kf(4);break;case 6:return e.return(a.map(function(w){return w.key}))}})},Fl=function(G,B,a,V,x){var h,e,w;
return g.v(function(K){if(K.j==1)return g.f(K,ou(),2);h=K.X;if(!h)return K.return([]);e=B.map(function(l){var k=g.WS(l,a);k={actionType:V,entityKey:k,actionMetadata:Object.assign({},apa(),x)};V!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(k.actionMetadata.priority=0);l=new tS(a,l,k);return I8(l)});
w=kdf(h,e);sqf(G.C);return K.return(w)})},Kuk=function(G,B,a,V){var x,h,e,w,K,l,k,N;
return g.v(function(d){switch(d.j){case 1:x=[],h=g.m(B),e=h.next();case 2:if(e.done){d.kf(4);break}w=e.value;if(w.upToDate||a&&!w.shouldAutoSyncMetadata||!w.playlistId){d.kf(3);break}K={};switch(V){case "mainPlaylistEntity":l={nextAutoRefreshIntervalSeconds:w.checkInSeconds,autoSync:a};K={mainPlaylistEntityActionMetadata:l};break;case "musicPlaylist":k={autoSync:a},K={musicPlaylistEntityActionMetadata:k}}return g.f(d,Fl(G,[w.playlistId],V,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",K),6);case 6:(N=
d.X)&&x.push.apply(x,g.U(N));case 3:e=h.next();d.kf(2);break;case 4:return d.return(x)}})},lAs=function(G,B){var a;
return g.v(function(V){return B.length?(a=apa(),g.uY(a,Si,{isEnqueuedForExpiredStreamUrlRefetch:!0}),G.api.FJ("qrd",{v:B.length}),V.return(Fl(G,B,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",a))):V.return([])})},kVh=function(G,B,a){this.j=G;
this.md=B;this.C=a},Cu3=function(G,B){var a,V,x,h,e,w,K,l,k,N,d,C,z,p,O,b,c;
return g.v(function(H){switch(H.j){case 1:return a=wn(B),V=g.e9(B.entityKey),x=V.entityId,h=[],g.UA(H,2),g.f(H,Ni7(G,x),4);case 4:h=H.X;if(!(G.md.S("woffle_enable_main_downloads_library")&&((e=h)==null?0:e.length))){H.kf(5);break}return g.f(H,zO3(G.j,[B.entityKey]),5);case 5:g.EA(H,3);break;case 2:return w=g.jB(H),K="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",w instanceof g.z0&&w.type==="QUOTA_EXCEEDED"?(K="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):a8("Playlist add error"),H.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,K,l));case 3:k=[];if(!G.md.S("html5_offline_prevent_redownload_downloaded_video")){H.kf(7);break}return g.f(H,GR2(G.j,"mainVideoEntity",h),8);case 8:h=H.X;case 7:if((N=h)==null?0:N.length)for(d=g.m(h),C=d.next();!C.done;C=d.next())if(z=C.value,p=z.offlineVideoData,O=void 0,(O=p)==null?0:O.videoId)b=void 0,c=Number(((b=B.actionMetadata)==null?void 0:b.priority)||
0)+1,k.push(vy("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",p.videoId,"mainVideoEntity",c,JS,d4h(B,p,x)));return H.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,k))}})},tbW=function(G,B){var a,V,x,h,e,w,K,l,k,N,d,C,z,p,O,b,c,H,R,q,A,J,xB,Wz,GK,Q,M,I,L,ux,U3,dl,cz,Pz,hJ,tJ,E,y,n,D,Z,Bz,hg,eB,S,kB,tg,KV,vz,Cs,Xh,dK,sA,qU,K0,vq,F2,Ko,sz,uk,Fm,Uz,lQ,SU,d3,Rz,Zf,rj,c2,o5,Jw,Vj,Er,ql;
return g.v(function(Cd){switch(Cd.j){case 1:return a=wn(B),V=B.entityKey,x=g.e9(V).entityId,h=[],e=!1,x==="!*$_ALL_ENTITIES_!*$"?(e=!0,g.f(Cd,Pc(G.j,"mainPlaylistEntity"),5)):g.f(Cd,iJ(G.j,V,"mainPlaylistEntity"),4);case 4:(w=Cd.X)&&h.push(w);Cd.kf(3);break;case 5:h=Cd.X;case 3:if((K=h)==null||!K.length)return Cd.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a));l=g.u(B.actionMetadata,zRC);N=(k=l)==null?void 0:k.nextAutoRefreshIntervalSeconds;C=(d=l)==null?void 0:d.autoSync;z=[];O=p=
!0;b=!1;if(!e&&C===!1){Cd.kf(6);break}g.UA(Cd,7);return g.f(Cd,fpJ(0,!!C,!0,h),9);case 9:z=Cd.X;g.EA(Cd,8);break;case 7:c=g.jB(Cd);if(!(c instanceof Error&&c.message==="No data")){c instanceof Error&&c.message==="Empty response body"&&a8(c.message);Cd.kf(8);break}return x==="!*$_ALL_ENTITIES_!*$"?g.f(Cd,K83(G.j,B,G.C,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.f(Cd,W8l(x,G.j,B,G.C),8);case 8:if(!z.length||!e&&z[0].playlistId!==x)return Cd.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
a));case 6:if(e){H=[];R=g.m(z);for(q=R.next();!q.done;q=R.next())A=q.value,A.upToDate||C&&!A.shouldAutoSyncMetadata||!A.playlistId||(J={nextAutoRefreshIntervalSeconds:A.checkInSeconds,autoSync:C},H.push(vy("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",A.playlistId,"mainPlaylistEntity",0,JS,{mainPlaylistEntityActionMetadata:J})));return Cd.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,H))}z.length&&(xB=z[0],b=!!xB.upToDate,C&&(p=(Wz=xB.shouldAutoSyncMetadata)!=null?Wz:!0,O=(GK=xB.shouldAutoSyncVideos)!=
null?GK:!0,xB.checkInSeconds&&(N=xB.checkInSeconds)));if(b||!p)return Cd.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a));Q=[];M=h[0];if(!M.downloadState){I=void 0;Cd.kf(15);break}return g.f(Cd,iJ(G.j,M.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:I=Cd.X;case 15:return L=I,U3=((ux=L)==null?0:ux.addedTimestampMillis)?String(L.addedTimestampMillis):void 0,g.UA(Cd,17),g.f(Cd,Ni7(G,x,U3,N),19);case 19:Q=Cd.X;g.EA(Cd,18);break;case 17:dl=g.jB(Cd);if(!(dl instanceof Error&&
dl.message==="No data for playlist")){if(dl instanceof Error&&dl.message==="Empty response body for playlist")a8(dl.message);else return cz="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Pz="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",dl instanceof g.z0&&dl.type==="QUOTA_EXCEEDED"&&(cz="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Pz="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Cd.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,cz,Pz));Cd.kf(18);
break}return g.f(Cd,W8l(x,G.j,B,G.C),18);case 18:if(!O)return Cd.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a));hJ=[];tJ=new Map;if((E=Q)==null?0:E.length)for(y=g.m(Q),n=y.next();!n.done;n=y.next())D=n.value,Z=D.offlineVideoData,Bz=void 0,((Bz=Z)==null?0:Bz.videoId)&&tJ.set(Z.videoId,Z);hg=new Map;eB=[];if((S=M)==null?0:(kB=S.videos)==null?0:kB.length)for(tg=g.m(M.videos),KV=tg.next();!KV.done;KV=tg.next())if(vz=KV.value,Cs=JSON.parse(g.e9(vz).entityId),Xh=Cs.videoId)tJ.has(Xh)?(hg.set(Xh,
tJ.get(Xh)),tJ.delete(Xh)):eB.push(Xh);sA=Number(((dK=B.actionMetadata)==null?void 0:dK.priority)||0)+1;qU=g.m(tJ.entries());for(K0=qU.next();!K0.done;K0=qU.next())vq=K0.value,F2=g.m(vq),Ko=F2.next().value,sz=F2.next().value,uk=Ko,Fm=sz,hJ.push(vy("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",uk,"mainVideoEntity",sA,JS,d4h(B,Fm,x)));Uz=g.m(hg.entries());for(lQ=Uz.next();!lQ.done;lQ=Uz.next())SU=lQ.value,d3=g.m(SU),Rz=d3.next().value,Zf=d3.next().value,rj=Rz,c2=Zf,hJ.push(vy("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
rj,"mainVideoEntity",sA,JS,d4h(B,c2,x)));o5=g.m(eB);for(Jw=o5.next();!Jw.done;Jw=o5.next())Vj=Jw.value,Er={playlistId:x},ql={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:Er},hJ.push(vy("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Vj,"mainVideoEntity",0,JS,ql));return Cd.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,hJ))}})},m4W=function(G,B){var a,V,x,h;
return g.v(function(e){switch(e.j){case 1:return a=wn(B),g.UA(e,2),V=g.e9(B.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.f(e,K83(G.j,B,G.C,(x=B.actionMetadata)==null?void 0:(h=x.offlineLoggingData)==null?void 0:h.offlineDeleteReason),5):g.f(e,W8l(V,G.j,B,G.C),6);case 6:if(!G.md.S("woffle_enable_main_downloads_library")){e.kf(5);break}return g.f(e,tp$(G.j,B.entityKey),5);case 5:g.EA(e,3);break;case 2:return g.jB(e),e.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return e.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a))}})},Ni7=function(G,B,a,V){var x,h,e,w,K,l,k;
return g.v(function(N){switch(N.j){case 1:return g.f(N,ccW([B]),2);case 2:return x=N.X,g.f(N,IAh(G,x[0],a,V),3);case 3:return h=N.X,e=h.mainPlaylistEntity,w=h.yvd,l=hOs(e,(K=w)==null?void 0:K.avatar),g.UA(N,4),g.f(N,pC(l),6);case 6:g.EA(N,5);break;case 4:k=g.jB(N),k instanceof Error&&k.message==="Failed to fetch"&&a8(k.message);case 5:return N.return(x[0].videos)}})},IAh=function(G,B,a,V){var x,h,e,w,K,l,k,N,d,C,z,p,O,b,c,H,R;
return g.v(function(q){switch(q.j){case 1:x=Date.now().toString();a||(a=x);h=B.videos;e=B.playlistId;w=[];K=[];if(h)for(l=g.m(h),k=l.next();!k.done;k=l.next()){N=k.value;d=N.offlineVideoData;if(!d||!d.videoId)throw a8("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");C=d.videoId;z={videoId:C,playlistId:e};p={id:g.WS(JSON.stringify(z),"mainPlaylistVideoEntity"),video:g.WS(C,"mainVideoEntity")};w.push(p);K.push(p.id)}b={key:g.WS(e,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:a,lastSyncedTimestampMillis:x};c={key:g.WS(e,"mainPlaylistEntity"),playlistId:e,videos:K,title:B.title,thumbnailStyleData:g$7(B),visibility:pC$(B),downloadState:b.key};B.channel&&(H=B.channel.offlineChannelData,O=U4a(g.WS(e,"ytMainChannelEntity"),H),c.channelOwner=O.id);((R=c)==null?0:R.entityMetadata)?(c.entityMetadata.offlineLastModifiedTimestampSeconds=B.lastModifiedTimestamp,V&&(c.entityMetadata.nextAutoRefreshIntervalSeconds=String(V))):c&&(c.entityMetadata={nextAutoRefreshIntervalSeconds:V?
String(V):void 0,offlineLastModifiedTimestampSeconds:B.lastModifiedTimestamp});g.UA(q,2);return g.f(q,Av(G.j,{mode:"readwrite",hs:!0},function(A){var J=Tr(A,c,"mainPlaylistEntity"),xB=Tr(A,b,"mainPlaylistDownloadStateEntity");J=[J,xB];xB=g.m(w);for(var Wz=xB.next();!Wz.done;Wz=xB.next())J.push(Tr(A,Wz.value,"mainPlaylistVideoEntity"));O&&J.push(Tr(A,O,"ytMainChannelEntity"));return g.OV.all(J)}),4);
case 4:g.EA(q,3);break;case 2:throw g.jB(q),a8("PES failure for playlist"),Error("PES failure for playlist");case 3:return q.return({mainPlaylistEntity:c,yvd:O,QrJ:w})}})},U4a=function(G,B){return{id:G,
channelId:B.channelId,title:B.title,avatar:B.thumbnail}},g$7=function(G){var B=[],a=G.videos;
a&&a.length>0&&B.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:a[0].offlineVideoData.thumbnail}}});if((G=G.additionalMetadadatas)&&G.length>0)for(G=g.m(G),a=G.next();!a.done;a=G.next()){var V=a.value.offlineBundleItemPlaylistData,x=void 0;a=(x=V)==null?void 0:x.style;x=void 0;V={collageThumbnail:{coverThumbnail:(x=V)==null?void 0:x.coverThumbnail}};switch(a){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":B.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:V});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":B.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:V});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":B.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:V});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":B.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:V})}}return B},pC$=function(G){switch(G.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},d4h=function(G,B,a){B={offlineVideoData:B,
playlistId:a};if(G=g.u(G.actionMetadata,zRC))B.maximumDownloadQuality=G.maximumDownloadQuality;return{mainVideoEntityActionMetadata:B}},OmC=function(G,B,a){this.j=G;
this.md=B;this.C=a},bmh=function(G,B){var a,V,x,h,e,w,K,l,k,N,d,C,z;
return g.v(function(p){switch(p.j){case 1:return a=wn(B),V=g.e9(B.entityKey),x=V.entityId,h=g.u(B.actionMetadata,AS),w=!((e=h)==null?0:e.playlistId),g.UA(p,2),g.f(p,E$C(G,x,void 0,(K=h)==null?void 0:K.offlineVideoData,w),4);case 4:g.EA(p,3);break;case 2:return l=g.jB(p),k="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.z0&&l.type==="QUOTA_EXCEEDED"&&(k="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
p.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,k,N));case 3:d=1;d=Number(((C=B.actionMetadata)==null?void 0:C.priority)||0)+1;var O=(O=g.u(B.actionMetadata,AS))?{playbackDataActionMetadata:{maximumDownloadQuality:O.maximumDownloadQuality}}:void 0;z=vy("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",x,"playbackData",d,jRW,O);return p.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,[z]))}})},yis=function(G,B){var a,V,x,h,e,w,K,l,k,N,d,C,z,p,O,b,c;
return g.v(function(H){switch(H.j){case 1:return a=wn(B),V=g.e9(B.entityKey),x=V.entityId,g.f(H,iJ(G.j,B.entityKey,"mainVideoEntity"),2);case 2:h=H.X;if(!h){e=void 0;H.kf(3);break}return g.f(H,iJ(G.j,h.downloadState,"mainVideoDownloadStateEntity"),4);case 4:e=H.X;case 3:w=e;if(!h||!w)return H.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a));g.UA(H,5);return g.f(H,E$C(G,x,w.addedTimestampMillis,(l=g.u(B.actionMetadata,AS))==null?void 0:l.offlineVideoData),7);case 7:k=1;k=Number(((N=
B.actionMetadata)==null?void 0:N.priority)||0)+1;K=vy("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",x,"playbackData",k,jRW);g.EA(H,6);break;case 5:d=g.jB(H);if(!(d instanceof Error&&d.message==="No data")){if(d instanceof Error&&d.message==="Empty response body")a8(d.message);else return C="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",d instanceof g.z0&&d.type==="QUOTA_EXCEEDED"&&(C="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),H.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,C,z));H.kf(6);break}return g.f(H,ES(G.j,x),9);case 9:p=H.X;O=g.u(B.actionMetadata,AS);if(c=(b=O)==null?void 0:b.playlistId)p.playlistId=c;p.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.f(H,US(x,G.j,B,G.C,p),6);case 6:return H.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,K?[K]:void 0))}})},cif=function(G,B){var a,V,x,h,e,w,K,l,k,N;
return g.v(function(d){switch(d.j){case 1:return a=wn(B),g.UA(d,2),V=g.e9(B.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.f(d,K83(G.j,B,G.C,(k=B.actionMetadata)==null?void 0:(N=k.offlineLoggingData)==null?void 0:N.offlineDeleteReason),5):g.f(d,ES(G.j,V),6);case 6:x=d.X;h=g.u(B.actionMetadata,AS);if(w=(e=h)==null?void 0:e.playlistId)x.playlistId=w;x.offlineDeleteReason=(K=B.actionMetadata)==null?void 0:(l=K.offlineLoggingData)==null?void 0:l.offlineDeleteReason;return g.f(d,US(V,G.j,B,G.C,x),7);
case 7:if(!G.md.S("woffle_enable_main_downloads_library")){d.kf(5);break}return g.f(d,tp$(G.j,B.entityKey),5);case 5:g.EA(d,3);break;case 2:return g.jB(d),d.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return d.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a))}})},E$C=function(G,B,a,V,x){var h,e,w,K,l,k;
return g.v(function(N){switch(N.j){case 1:if(h=V){N.kf(2);break}return g.f(N,ycC([B]),3);case 3:e=N.X,h=e[0];case 2:return g.f(N,n$C(G,h,a,x),4);case 4:w=N.X;K=w.mainVideoEntity;l=w.channelEntity;g.UA(N,5);var d=zW(K.thumbnail),C=zW(l.avatar);return g.f(N,pC(d.concat(C)),7);case 7:g.EA(N,0);break;case 5:k=g.jB(N),k instanceof Error&&k.message==="Failed to fetch"&&a8(k.message),g.pV(N)}})},n$C=function(G,B,a,V){var x,h,e,w,K,l,k,N,d,C,z,p,O;
return g.v(function(b){switch(b.j){case 1:a||(a=Date.now().toString());h=(x=B.channel)==null?void 0:x.offlineChannelData;e={id:g.WS(B.videoId,"ytMainChannelEntity"),channelId:h.channelId,title:h.title,avatar:h.thumbnail};w={key:g.WS(B.videoId,"mainVideoDownloadStateEntity"),playbackData:g.WS(B.videoId,"playbackData"),addedTimestampMillis:a,videoDownloadContextEntity:g.WS(B.videoId,"videoDownloadContextEntity")};K={key:g.WS(B.videoId,"videoPlaybackPositionEntity"),videoId:B.videoId,lastPlaybackPositionSeconds:"0"};
G.md.S("html5_offline_playback_position_sync")&&(l={playbackPosition:K.key});k=g.WS(B.videoId,"mainVideoEntity");N={key:k,videoId:B.videoId,title:B.title,thumbnail:B.thumbnail,localizedStrings:{viewCount:B.shortViewCountText},userState:l,lengthSeconds:B.lengthSeconds?Number(B.lengthSeconds):void 0,publishedTimestampMillis:B.publishedTimestamp?(Number(B.publishedTimestamp)*1E3).toString():void 0,formattedDescription:B.description,owner:e.id,downloadState:w.key};if(!G.md.S("woffle_enable_main_downloads_library")||
!V){b.kf(2);break}return g.f(b,CG$(G.j,[k]),3);case 3:if(z=b.X)d=z.mainDownloadsLibraryEntity,C=z.mainDownloadsListEntity;case 2:return O=M3a,p={key:g.WS(B.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.uY(w,O,p),g.f(b,Av(G.j,{mode:"readwrite",hs:!0},function(c){var H=Tr(c,e,"ytMainChannelEntity"),R=Tr(c,w,"mainVideoDownloadStateEntity"),q=Tr(c,N,"mainVideoEntity");H=[H,R,q];G.md.S("html5_offline_playback_position_sync")&&(R=Tr(c,K,"videoPlaybackPositionEntity"),
H.push(R));d&&(R=Tr(c,d,"mainDownloadsLibraryEntity"),H.push(R));C&&(R=Tr(c,C,"mainDownloadsListEntity"),H.push(R));p&&(c=Tr(c,p,"downloadStatusEntity"),H.push(c));return g.OV.all(H)}),4);
case 4:return b.return({mainVideoEntity:N,channelEntity:e})}})},fAs=function(G,B,a){this.j=G;
this.md=B;this.C=a},v$h=function(G,B){var a,V,x,h,e,w,K,l,k,N,d,C,z,p,O,b,c,H,R,q,A,J,xB,Wz,GK,Q,M;
return g.v(function(I){switch(I.j){case 1:return a=wn(B),V=[],g.f(I,$6.getInstance(),2);case 2:x=I.X;if(!x){I.kf(3);break}return g.f(I,x.get("sdois"),4);case 4:return h=I.X,g.f(I,(w=x)==null?void 0:w.get("lmqf"),5);case 5:e=I.X;case 3:g.UA(I,6);if(h===void 0)throw Error("prefStorage or opt-in state is undefined");K=[];if(h){I.kf(8);break}return g.f(I,d7a(G.j),9);case 9:K=I.X,K.reverse();case 8:if(!K.length){I.kf(10);break}l=g.m(K);k=l.next();case 11:if(k.done){I.kf(10);break}N=k.value;if(!N){I.kf(12);
break}d=g.e9(N).entityId;return g.f(I,ES(G.j,d),14);case 14:return C=I.X,C.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.f(I,US(d,G.j,{entityKey:N,actionType:B.actionType},G.C,C),12);case 12:k=l.next();I.kf(11);break;case 10:return g.f(I,vmJ(h,(z=e)!=null?z:"SD"),16);case 16:return p=I.X,g.f(I,lpC(p),17);case 17:O=Nb$(p);if(!G.md.S("woffle_enable_main_downloads_library")){I.kf(18);break}if(h){I.kf(19);break}return g.f(I,tp$(G.j,g.S4),19);case 19:return g.f(I,zO3(G.j,[g.S4]),18);
case 18:if((b=O)==null?0:b.length)for(c=g.m(O),H=c.next();!H.done;H=c.next())if(q=R=H.value,A=q.actionType,J=q.entityKey,xB=q.actionMetadata,A&&J&&xB&&!g.u(xB,Hm7)){A==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(xB.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(Wz=g.u(R.actionMetadata,AS))Wz.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",R.actionMetadata=Object.assign({},R.actionMetadata,{mainVideoEntityActionMetadata:Wz});V.push(R)}g.EA(I,7);break;
case 6:return GK=g.jB(I),Q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",GK instanceof g.z0&&GK.type==="QUOTA_EXCEEDED"&&(Q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),I.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,Q,M));case 7:return I.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,V))}})},D4J=function(){sS.apply(this,arguments);
this.Y="mainVideoEntity"},SJW=function(G,B,a){B=B===void 0?43200:B;
a=a===void 0?!0:a;var V=V===void 0?!1:V;var x,h,e;return g.v(function(w){switch(w.j){case 1:if(!G.L.JA())return w.return([]);x=[];g.UA(w,2);return g.f(w,fpJ(B,a,V),4);case 4:x=w.X;g.EA(w,3);break;case 2:h=g.jB(w),h instanceof Error&&h.message==="No data"||h instanceof Error&&h.message==="Empty response body"&&a8(h.message);case 3:return e=Kuk(G,x,a,"mainPlaylistEntity"),w.return(e)}})},RRl=function(G,B,a,V){V=V===void 0?!1:V;
var x,h,e,w,K,l,k,N,d,C,z,p,O,b,c;return g.v(function(H){switch(H.j){case 1:return x=[],g.f(H,Htf(),2);case 2:return(h=H.X)||V?g.f(H,D79(B,a),3):H.return([]);case 3:e=H.X;if((w=e)==null||!w.length)return H.return([]);K={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};l=g.m(e);k=l.next();case 4:if(k.done){H.kf(6);break}d=N=k.value;C=d.actionType;z=d.entityKey;p=d.actionMetadata;if(!(C&&z&&p)||g.u(p,Hm7)){H.kf(5);break}C==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(p.offlineLoggingData=
K);O=g.e9(z);b=O.entityId;return g.f(H,Fl(G,[b],"mainVideoEntity",C,p),8);case 8:c=H.X,x=x.concat(c);case 5:k=l.next();H.kf(4);break;case 6:return H.return(x)}})},Zmh=function(G,B){this.j=G;
this.C=B},$49=function(G,B){var a,V,x,h,e,w,K,l,k,N,d,C,z,p,O,b;
return g.v(function(c){switch(c.j){case 1:return a=wn(B),V=g.e9(B.entityKey),x=V.entityId,h=[],g.UA(c,2),g.f(c,ri$(G,x),4);case 4:h=c.X;if((e=h)==null||!e.length){c.kf(5);break}return g.f(c,U77(G.j,B.entityKey),5);case 5:g.EA(c,3);break;case 2:return w=g.jB(c),K="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",w instanceof g.z0&&w.type==="QUOTA_EXCEEDED"&&(K="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
c.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,K,l));case 3:return k=[],g.f(c,GR2(G.j,"musicTrack",h),7);case 7:h=c.X;if(h.length)for(N=g.m(h),d=N.next();!d.done;d=N.next())if(C=d.value,z=C.offlineVideoData,p=void 0,(p=z)==null?0:p.videoId)O=void 0,b=Number(((O=B.actionMetadata)==null?void 0:O.priority)||0)+1,k.push(vy("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",z.videoId,"musicTrack",b,YP,cy(B,z,x)));return c.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,k))}})},
XC7=function(G,B){var a,V,x,h,e,w,K,l,k,N,d,C,z,p,O,b,c,H,R,q,A,J,xB,Wz,GK,Q,M,I,L,ux,U3,dl,cz,Pz,hJ,tJ,E,y,n,D,Z,Bz,hg,eB,S,kB,tg,KV,vz,Cs,Xh,dK,sA,qU,K0,vq,F2,Ko,sz;
return g.v(function(uk){switch(uk.j){case 1:return a=wn(B),V=B.entityKey,x=g.e9(V).entityId,h=[],e=!1,x==="!*$_ALL_ENTITIES_!*$"?(e=!0,g.f(uk,Pc(G.j,"musicAlbumRelease"),5)):g.f(uk,iJ(G.j,V,"musicAlbumRelease"),4);case 4:(w=uk.X)&&h.push(w);uk.kf(3);break;case 5:h=uk.X;case 3:if((K=h)==null||!K.length)return uk.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a));if(e){l=[];k=g.m(h);for(N=k.next();!N.done;N=k.next())d=N.value,C=g.e9(d.id).entityId,l.push(vy("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
C,"musicAlbumRelease",0,YP));return uk.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,l))}z=[];p=h[0];O=void 0;if(!p.downloadMetadata){uk.kf(6);break}return g.f(uk,iJ(G.j,p.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:b=uk.X,O=Number((H=(c=b)==null?void 0:c.addedTimestampMillis)!=null?H:"0")/1E3;case 6:return g.UA(uk,8),g.f(uk,ri$(G,x,(R=O)==null?void 0:R.toString()),10);case 10:z=uk.X;g.EA(uk,9);break;case 8:q=g.jB(uk);if(!(q instanceof Error&&q.message===
"No data")){if(q instanceof Error&&q.message==="Empty response body")a8(q.message);else return A="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",q instanceof g.z0&&q.type==="QUOTA_EXCEEDED"&&(A="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),uk.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,A,J));uk.kf(9);break}return g.f(uk,bZ(x,"musicAlbumRelease",G.j,
B,G.C),9);case 9:xB=[];Wz=new Map;if((GK=z)==null?0:GK.length)for(Q=g.m(z),M=Q.next();!M.done;M=Q.next())I=M.value,L=I.offlineVideoData,ux=void 0,((ux=L)==null?0:ux.videoId)&&Wz.set(L.videoId,L);U3=new Map;dl=[];if((cz=p)==null?0:(Pz=cz.tracks)==null?0:Pz.length)for(hJ=g.m(p.tracks),tJ=hJ.next();!tJ.done;tJ=hJ.next())if(E=tJ.value,y=g.e9(E).entityId)Wz.has(y)?(U3.set(y,Wz.get(y)),Wz.delete(y)):dl.push(y);D=Number(((n=B.actionMetadata)==null?void 0:n.priority)||0)+1;Z=g.m(Wz.entries());for(Bz=Z.next();!Bz.done;Bz=
Z.next())hg=Bz.value,eB=g.m(hg),S=eB.next().value,kB=eB.next().value,tg=S,KV=kB,xB.push(vy("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",tg,"musicTrack",D,YP,cy(B,KV)));vz=g.m(U3.entries());for(Cs=vz.next();!Cs.done;Cs=vz.next())Xh=Cs.value,dK=g.m(Xh),sA=dK.next().value,qU=dK.next().value,K0=sA,vq=qU,xB.push(vy("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",K0,"musicTrack",D,YP,cy(B,vq)));F2=g.m(dl);for(Ko=F2.next();!Ko.done;Ko=F2.next())sz=Ko.value,xB.push(vy("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",sz,
"musicTrack",0,YP));return uk.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,xB))}})},qJC=function(G,B){var a,V;
return g.v(function(x){switch(x.j){case 1:return a=wn(B),g.UA(x,2),V=g.e9(B.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.f(x,yh(G.j,B,G.C),5):g.f(x,bZ(V,"musicAlbumRelease",G.j,B,G.C),6);case 6:return g.f(x,Ot9(G.j,B.entityKey),5);case 5:g.EA(x,3);break;case 2:return g.jB(x),x.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return x.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
a))}})},ri$=function(G,B,a){var V,x,h;
return g.v(function(e){switch(e.j){case 1:return g.f(e,ccW([B]),2);case 2:return V=e.X,g.f(e,ufC(G,V[0],a),3);case 3:return x=e.X,h=zW(x.thumbnailDetails),g.f(e,pC(h),4);case 4:return e.return(V[0].videos)}})},ufC=function(G,B,a){var V,x,h,e,w,K,l,k,N,d,C,z,p,O;
return g.v(function(b){if(b.j==1){V=B.additionalMetadadatas;x=void 0;if(V&&V.length>0)for(h=g.m(V),e=h.next();!e.done;e=h.next())if(w=e.value,w.offlineMusicPlaylistData){x=w.offlineMusicPlaylistData;break}K=B.playlistId;l=Ema(B);k=l.So;N=l.BO;d=a?(Number(a)*1E3).toString():Date.now().toString();C=B.lastModifiedTimestamp?(Number(B.lastModifiedTimestamp)*1E3).toString():"0";z={id:g.WS(K,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:N,lastModifiedTimestampMillis:C,addedTimestampMillis:d,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};p={id:g.WS(K,"musicAlbumRelease"),title:B.title,audioPlaylistId:K,trackCount:B.totalVideoCount,tracks:k,downloadMetadata:z.id};x&&(p.thumbnailDetails=(O=x.albumHqThumbnail)!=null?O:x.albumArtistThumbnail,p.artistDisplayName=x.albumArtistDisplayName,p.releaseDate=x.albumReleaseDate,p.contentRating={explicitType:x.albumReleaseExplicitType},p.releaseType=x.albumReleaseType);return g.f(b,Av(G.j,{mode:"readwrite",hs:!0},function(c){var H=Tr(c,p,"musicAlbumRelease");
c=Tr(c,z,"musicAlbumReleaseDownloadMetadataEntity");return g.OV.all([H,c])}),2)}return b.return(p)})},QRC=function(G,B){this.j=G;
this.C=B},TiC=function(G,B){var a,V,x,h,e,w,K,l,k,N,d,C,z,p,O,b;
return g.v(function(c){switch(c.j){case 1:return a=wn(B),V=g.e9(B.entityKey),x=V.entityId,h=[],g.UA(c,2),g.f(c,Lu8(G,x),4);case 4:h=c.X;if((e=h)==null||!e.length){c.kf(5);break}return g.f(c,U77(G.j,B.entityKey),5);case 5:g.EA(c,3);break;case 2:return w=g.jB(c),K="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",w instanceof g.z0&&w.type==="QUOTA_EXCEEDED"&&(K="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",l="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
c.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,K,l));case 3:return k=[],g.f(c,GR2(G.j,"musicTrack",h),7);case 7:h=c.X;if(h.length)for(N=g.m(h),d=N.next();!d.done;d=N.next())if(C=d.value,z=C.offlineVideoData,p=void 0,(p=z)==null?0:p.videoId)O=void 0,b=Number(((O=B.actionMetadata)==null?void 0:O.priority)||0)+1,k.push(vy("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",z.videoId,"musicTrack",b,iZ,cy(B,z,x)));return c.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,k))}})},
sRf=function(G,B){var a,V,x,h,e,w,K,l,k,N,d,C,z,p,O,b,c,H,R,q,A,J,xB,Wz,GK,Q,M,I,L,ux,U3,dl,cz,Pz,hJ,tJ,E,y,n,D,Z,Bz,hg,eB,S,kB,tg,KV,vz,Cs,Xh,dK,sA,qU,K0,vq,F2,Ko,sz,uk,Fm,Uz,lQ,SU,d3,Rz,Zf,rj,c2,o5,Jw;
return g.v(function(Vj){switch(Vj.j){case 1:return a=wn(B),V=B.entityKey,x=g.e9(V).entityId,h=[],e=!1,x==="!*$_ALL_ENTITIES_!*$"?(e=!0,g.f(Vj,Pc(G.j,"musicPlaylist"),5)):g.f(Vj,iJ(G.j,V,"musicPlaylist"),4);case 4:(w=Vj.X)&&h.push(w);Vj.kf(3);break;case 5:h=Vj.X;case 3:if((K=h)==null||!K.length)return Vj.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a));l=g.u(B.actionMetadata,jK8);N=(k=l)==null?void 0:k.autoSync;d=[];z=C=!0;p=!1;O=void 0;if(!e&&N===!1){Vj.kf(6);break}g.UA(Vj,7);return g.f(Vj,
S9$(0,!!N,!0,h),9);case 9:d=Vj.X;g.EA(Vj,8);break;case 7:b=g.jB(Vj);if(!(b instanceof Error&&b.message==="No data")){b instanceof Error&&b.message==="Empty response body"&&a8(b.message);Vj.kf(8);break}return x==="!*$_ALL_ENTITIES_!*$"?g.f(Vj,yh(G.j,B,G.C),8):g.f(Vj,bZ(x,"musicPlaylist",G.j,B,G.C),8);case 8:if(!d.length||!e&&d[0].playlistId!==x)return Vj.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a));case 6:if(e){c=[];H=g.m(d);for(R=H.next();!R.done;R=H.next())q=R.value,q.upToDate||
N&&!q.shouldAutoSyncMetadata||!q.playlistId||(A={autoSync:N},c.push(vy("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",q.playlistId,"musicPlaylist",0,iZ,{musicPlaylistEntityActionMetadata:A})));return Vj.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,c))}d.length&&(J=d[0],p=!!J.upToDate,N&&(C=(xB=J.shouldAutoSyncMetadata)!=null?xB:!0,z=(Wz=J.shouldAutoSyncVideos)!=null?Wz:!0,J.checkInSeconds&&(O=J.checkInSeconds)));if(p||!C)return Vj.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
a));GK=[];Q=h[0];M=void 0;if(!Q.downloadMetadata){Vj.kf(15);break}return g.f(Vj,iJ(G.j,Q.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:I=Vj.X,M=Number((ux=(L=I)==null?void 0:L.addedTimestampMillis)!=null?ux:"0")/1E3;case 15:return g.UA(Vj,17),g.f(Vj,Lu8(G,x,(U3=M)==null?void 0:U3.toString(),O),19);case 19:GK=Vj.X;g.EA(Vj,18);break;case 17:dl=g.jB(Vj);if(!(dl instanceof Error&&dl.message==="No data")){if(dl instanceof Error&&dl.message==="Empty response body")a8(dl.message);else return cz=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Pz="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",dl instanceof g.z0&&dl.type==="QUOTA_EXCEEDED"&&(cz="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Pz="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Vj.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,cz,Pz));Vj.kf(18);break}return g.f(Vj,bZ(x,"musicPlaylist",G.j,B,G.C),18);case 18:if(!z)return Vj.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
a));hJ=[];tJ=new Map;if((E=GK)==null?0:E.length)for(y=g.m(GK),n=y.next();!n.done;n=y.next())D=n.value,Z=D.offlineVideoData,Bz=void 0,((Bz=Z)==null?0:Bz.videoId)&&tJ.set(Z.videoId,Z);hg=new Map;eB=[];if((S=Q)==null?0:(kB=S.tracks)==null?0:kB.length)for(tg=g.m(Q.tracks),KV=tg.next();!KV.done;KV=tg.next())if(vz=KV.value,Cs=g.e9(vz).entityId)tJ.has(Cs)?(hg.set(Cs,tJ.get(Cs)),tJ.delete(Cs)):eB.push(Cs);dK=Number(((Xh=B.actionMetadata)==null?void 0:Xh.priority)||0)+1;sA=g.m(tJ.entries());for(qU=sA.next();!qU.done;qU=
sA.next())K0=qU.value,vq=g.m(K0),F2=vq.next().value,Ko=vq.next().value,sz=F2,uk=Ko,hJ.push(vy("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",sz,"musicTrack",dK,iZ,cy(B,uk)));Fm=g.m(hg.entries());for(Uz=Fm.next();!Uz.done;Uz=Fm.next())lQ=Uz.value,SU=g.m(lQ),d3=SU.next().value,Rz=SU.next().value,Zf=d3,rj=Rz,hJ.push(vy("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Zf,"musicTrack",dK,iZ,cy(B,rj)));c2=g.m(eB);for(o5=c2.next();!o5.done;o5=c2.next())Jw=o5.value,hJ.push(vy("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
Jw,"musicTrack",0,iZ));return Vj.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,hJ))}})},FuC=function(G,B){var a,V;
return g.v(function(x){switch(x.j){case 1:return a=wn(B),g.UA(x,2),V=g.e9(B.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.f(x,yh(G.j,B,G.C),5):g.f(x,bZ(V,"musicPlaylist",G.j,B,G.C),6);case 6:return g.f(x,Ot9(G.j,B.entityKey),5);case 5:g.EA(x,3);break;case 2:return g.jB(x),x.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return x.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
a))}})},Lu8=function(G,B,a,V){var x,h,e;
return g.v(function(w){switch(w.j){case 1:return g.f(w,ccW([B]),2);case 2:return x=w.X,g.f(w,JiW(G,x[0],a,V),3);case 3:return h=w.X,e=zW(h.thumbnailDetails),g.f(w,pC(e),4);case 4:return w.return(x[0].videos)}})},JiW=function(G,B,a,V){var x,h,e,w,K,l,k,N,d;
return g.v(function(C){return C.j==1?(x=B.playlistId,h=Ema(B),e=h.So,w=h.BO,K=a?(Number(a)*1E3).toString():Date.now().toString(),l=B.lastModifiedTimestamp?(Number(B.lastModifiedTimestamp)*1E3).toString():"0",k={id:g.WS(x,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:w,lastModifiedTimestampMillis:l,addedTimestampMillis:K,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},N={id:g.WS(x,"musicPlaylist"),title:B.title,playlistId:x,thumbnailDetails:B.thumbnail,visibility:Ail(B),trackCount:B.totalVideoCount,
tracks:e,downloadMetadata:k.id},V&&(((d=N)==null?0:d.entityMetadata)?N.entityMetadata.nextAutoRefreshIntervalSeconds=String(V):N&&(N.entityMetadata={nextAutoRefreshIntervalSeconds:String(V)})),g.f(C,Av(G.j,{mode:"readwrite",hs:!0},function(z){var p=Tr(z,N,"musicPlaylist");z=Tr(z,k,"musicPlaylistDownloadMetadataEntity");return g.OV.all([p,z])}),2)):C.return(N)})},Ail=function(G){switch(G.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},YJ$=function(G,B){this.j=G;
this.C=B},Mbf=function(G,B){var a,V,x,h,e,w,K,l,k,N,d,C,z;
return g.v(function(p){switch(p.j){case 1:return a=wn(B),V=g.e9(B.entityKey),x=V.entityId,h=g.u(B.actionMetadata,iml),g.UA(p,2),g.f(p,Pu2(G,x,void 0,(e=h)==null?void 0:e.track,(w=h)==null?void 0:w.albumRelease),4);case 4:if((K=h)==null?0:K.playlistId){p.kf(5);break}return g.f(p,U77(G.j,B.entityKey),5);case 5:g.EA(p,3);break;case 2:return l=g.jB(p),k="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.z0&&l.type==="QUOTA_EXCEEDED"&&
(k="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),p.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,k,N));case 3:C=Number(((d=B.actionMetadata)==null?void 0:d.priority)||0)+1;var O=(O=g.u(B.actionMetadata,iml))?{playbackDataActionMetadata:{maximumDownloadQuality:O.maximumDownloadQuality}}:void 0;z=vy("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",x,"playbackData",C,o$f,O);return p.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
a,[z]))}})},GY8=function(G,B){var a,V,x,h,e,w,K,l,k,N,d,C,z,p,O;
return g.v(function(b){switch(b.j){case 1:return a=wn(B),V=g.e9(B.entityKey),x=V.entityId,g.f(b,iJ(G.j,B.entityKey,"musicTrack"),2);case 2:h=b.X;if(!h){e=void 0;b.kf(3);break}return g.f(b,iJ(G.j,h.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:e=b.X;case 3:w=e;if(!h||!w)return b.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a));l=g.u(B.actionMetadata,iml);g.UA(b,5);return g.f(b,Pu2(G,x,w.addedTimestampMillis,(k=l)==null?void 0:k.track,(N=l)==null?void 0:N.albumRelease),
7);case 7:C=Number(((d=B.actionMetadata)==null?void 0:d.priority)||0)+1;K=vy("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",x,"playbackData",C,o$f);g.EA(b,6);break;case 5:z=g.jB(b);if(!(z instanceof Error&&z.message==="No data")){if(z instanceof Error&&z.message==="Empty response body")a8(z.message);else return p="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",z instanceof g.z0&&z.type==="QUOTA_EXCEEDED"&&(p="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),b.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,p,O));b.kf(6);break}return g.f(b,ji(x,G.j,B,G.C),6);case 6:return b.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",a,K?[K]:void 0))}})},BLW=function(G,B){var a,V;
return g.v(function(x){switch(x.j){case 1:return a=wn(B),g.UA(x,2),V=g.e9(B.entityKey).entityId,V==="!*$_ALL_ENTITIES_!*$"?g.f(x,yh(G.j,B,G.C),5):g.f(x,ji(V,G.j,B,G.C),6);case 6:return g.f(x,Ot9(G.j,B.entityKey),5);case 5:g.EA(x,3);break;case 2:return g.jB(x),x.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",a,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return x.return(new D6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
a))}})},Pu2=function(G,B,a,V,x){var h,e,w,K,l,k;
return g.v(function(N){switch(N.j){case 1:if(h=V){N.kf(2);break}return g.f(N,ycC([B]),3);case 3:e=N.X,w=e[0],h=pd3(w);case 2:return g.f(N,aml(G,h,B,x,a),4);case 4:K=N.X;l=K.musicTrackEntity;k=K.Nx;var d=zW(l.thumbnailDetails),C=[];k&&(C=zW(k.thumbnailDetails));return g.f(N,pC(d.concat(C)),0)}})},aml=function(G,B,a,V,x){var h;
return g.v(function(e){return e.j==1?(x||(x=Date.now().toString()),h={id:g.WS(a,"musicTrackDownloadMetadataEntity"),playbackData:g.WS(a,"playbackData"),addedTimestampMillis:x,videoDownloadContextEntity:g.WS(a,"videoDownloadContextEntity")},V&&(B.albumRelease=V.id),g.f(e,Av(G.j,{mode:"readwrite",hs:!0},function(w){var K=[],l=Tr(w,h,"musicTrackDownloadMetadataEntity");K.push(l);l=Tr(w,B,"musicTrack");K.push(l);V&&(w=Tr(w,V,"musicAlbumRelease"),K.push(w));return g.OV.all(K)}),2)):e.j!=3?g.f(e,Ni(a,"musicTrackDownloadMetadataEntity",
G.j,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):e.return({musicTrackEntity:B,
Nx:V})})},Py=function(){sS.apply(this,arguments);
this.Y="musicTrack"},VVh=function(G,B,a){B=B===void 0?43200:B;
a=a===void 0?!0:a;var V=V===void 0?!1:V;var x,h;return g.v(function(e){switch(e.j){case 1:if(!G.L.JA())return e.return([]);x=[];g.UA(e,2);return g.f(e,S9$(B,a,V),4);case 4:x=e.X;g.EA(e,3);break;case 2:g.jB(e);case 3:return h=Kuk(G,x,a,"musicPlaylist"),e.return(h)}})},xlC=function(){g.go.apply(this,arguments);
var G=this;this.events=new g.Zh(this);this.md=this.player.U();this.vC={ytJ:function(){return G.j},
zb:function(){return G.zb()},
LA:function(B){return G.LA(B)}}},hyJ=function(G){var B;
G=g.u((B=G.getWatchNextResponse())==null?void 0:B.currentVideoEndpoint,g.o0);if(G==null?0:G.playlistId)var a=G.playlistId;return a},eyk=function(G,B){var a,V,x,h;
return g.v(function(e){if(e.j==1){a=B.clientPlaybackNonce;V={cpn:a,offlineSourceVisualElement:g.E1(B.Zx||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};B.X&&(V.videoFmt=Number(B.X.itag));B.G&&(V.audioFmt=Number(B.G.itag));if((x=hyJ(B))&&B.videoId){var w=B.videoId;w=x!=="PPSV"?Promise.resolve(!1):G.j.GE(w);e=g.f(e,w,3)}else e=e.kf(2);return e}e.j!=2&&(h=e.X)&&(V.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");G.X=a;g.wP("offlinePlaybackStarted",V);g.pV(e)})};
g.bq.prototype.rA=g.Vb(51,function(G){return this.app.rA(G)});
g.mj.prototype.rA=g.Vb(50,function(G){return g.rSc(this,9,G)});
g.t(Z2,Ru);g.w_.Object.defineProperties(Z2.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.j.entityMetadata},
set:function(G){this.j.entityMetadata=G}}});
g.t(afs,Z2);afs.prototype.X=function(){return[]};
g.t(Vvs,Z2);Vvs.prototype.X=function(){return[]};
g.t(xo7,Z2);xo7.prototype.X=function(){return[]};
g.t(he2,Z2);he2.prototype.X=function(){return[]};
g.t(ee2,Z2);ee2.prototype.X=function(){var G=[];this.j.alternateChannel&&G.push(this.j.alternateChannel);this.j.alternateChannelList&&G.push.apply(G,g.U(this.j.alternateChannelList));this.j.oneofChannelEntity&&G.push(this.j.oneofChannelEntity);return[].concat(g.U(new Set(G)))};
g.t(WXh,Z2);WXh.prototype.X=function(){var G=[];this.j.entryCollection&&G.push(this.j.entryCollection);return[].concat(g.U(new Set(G)))};
g.t(wRC,Ru);wRC.prototype.X=function(){var G=[];this.j.video&&G.push(this.j.video);return[].concat(g.U(new Set(G)))};
g.t(KXW,Z2);KXW.prototype.X=function(){var G=[];this.j.parentPlaylist&&G.push(this.j.parentPlaylist);if(this.j.entries)for(var B=g.m(this.j.entries),a=B.next();!a.done;a=B.next())G.push.apply(G,g.U((new wRC(a.value)).X()));return[].concat(g.U(new Set(G)))};
g.t(lfC,Z2);lfC.prototype.X=function(){var G=[];this.j.descriptionEntity&&G.push(this.j.descriptionEntity);this.j.creators&&G.push.apply(G,g.U(this.j.creators));this.j.theBiggestFan&&G.push(this.j.theBiggestFan);return[].concat(g.U(new Set(G)))};
g.t(kUJ,Z2);kUJ.prototype.X=function(){return[]};
g.t(Njs,Z2);Njs.prototype.X=function(){return[]};
g.t(do$,Z2);do$.prototype.X=function(){return[]};
g.t(CA$,Z2);CA$.prototype.X=function(){return[]};
g.t(zea,Z2);zea.prototype.X=function(){return[]};
g.t(tvJ,Z2);tvJ.prototype.X=function(){return[]};
g.t(mo2,Z2);mo2.prototype.X=function(){return[]};
g.t(Iff,Z2);Iff.prototype.X=function(){return[]};
g.t(gO2,Z2);gO2.prototype.X=function(){return[]};
g.t(pRs,Z2);pRs.prototype.X=function(){var G=[];this.j.downloadsList&&G.push(this.j.downloadsList);this.j.smartDownloadsList&&G.push(this.j.smartDownloadsList);this.j.recommendedDownloadsList&&G.push(this.j.recommendedDownloadsList);this.j.refresh&&G.push(this.j.refresh);return[].concat(g.U(new Set(G)))};
g.t(Uo9,Ru);Uo9.prototype.X=function(){var G=[];this.j.video&&G.push(this.j.video);this.j.playlist&&G.push(this.j.playlist);this.j.videoItem&&G.push(this.j.videoItem);this.j.playlistItem&&G.push(this.j.playlistItem);return[].concat(g.U(new Set(G)))};
g.t(Oc$,Z2);Oc$.prototype.X=function(){var G=[];this.j.refresh&&G.push(this.j.refresh);if(this.j.downloads)for(var B=g.m(this.j.downloads),a=B.next();!a.done;a=B.next())G.push.apply(G,g.U((new Uo9(a.value)).X()));return[].concat(g.U(new Set(G)))};
g.t(EOh,Z2);EOh.prototype.X=function(){var G=[];this.j.localImageEntities&&G.push.apply(G,g.U(this.j.localImageEntities));return[].concat(g.U(new Set(G)))};
g.t(jQ$,Z2);jQ$.prototype.X=function(){var G=[];this.j.playbackData&&G.push(this.j.playbackData);this.j.localImageEntities&&G.push.apply(G,g.U(this.j.localImageEntities));this.j.videoDownloadContextEntity&&G.push(this.j.videoDownloadContextEntity);return[].concat(g.U(new Set(G)))};
g.t(bc7,Z2);bc7.prototype.X=function(){return[]};
g.t(yfs,Z2);yfs.prototype.X=function(){var G=[];this.j.fakeChildren&&G.push.apply(G,g.U(this.j.fakeChildren));return[].concat(g.U(new Set(G)))};
g.t(cf2,Z2);cf2.prototype.X=function(){var G=[];this.j.video&&G.push(this.j.video);this.j.playbackData&&G.push(this.j.playbackData);this.j.offlineVideoPolicy&&G.push(this.j.offlineVideoPolicy);return[].concat(g.U(new Set(G)))};
g.t(nOC,Z2);nOC.prototype.X=function(){return[]};
g.t(fff,Z2);fff.prototype.X=function(){var G=[];this.j.channelOwner&&G.push(this.j.channelOwner);this.j.videos&&G.push.apply(G,g.U(this.j.videos));this.j.collaboratorChannels&&G.push.apply(G,g.U(this.j.collaboratorChannels));this.j.downloadState&&G.push(this.j.downloadState);this.j.refresh&&G.push(this.j.refresh);return[].concat(g.U(new Set(G)))};
g.t(Hcs,Z2);Hcs.prototype.X=function(){var G=[];this.j.video&&G.push(this.j.video);this.j.channelContributor&&G.push(this.j.channelContributor);return[].concat(g.U(new Set(G)))};
g.t(vOC,Ru);vOC.prototype.X=function(){var G=[];this.j.localImageEntities&&G.push.apply(G,g.U(this.j.localImageEntities));this.j.videoDownloadContextEntity&&G.push(this.j.videoDownloadContextEntity);return[].concat(g.U(new Set(G)))};
g.t(DoC,Ru);DoC.prototype.X=function(){var G=[];this.j.recommendedVideoMetadata&&G.push.apply(G,g.U((new vOC(this.j.recommendedVideoMetadata)).X()));return[].concat(g.U(new Set(G)))};
g.t(SWh,Ru);SWh.prototype.X=function(){var G=[];this.j.playbackPosition&&G.push(this.j.playbackPosition);return[].concat(g.U(new Set(G)))};
g.t(Reh,Z2);Reh.prototype.X=function(){var G=[];this.j.owner&&G.push(this.j.owner);this.j.downloadState&&G.push(this.j.downloadState);this.j.userState&&G.push.apply(G,g.U((new SWh(this.j.userState)).X()));this.j.additionalMetadata&&G.push.apply(G,g.U((new DoC(this.j.additionalMetadata)).X()));return[].concat(g.U(new Set(G)))};
g.t(Zcl,Z2);Zcl.prototype.X=function(){var G=[];this.j.userChannelDetails&&G.push(this.j.userChannelDetails);return[].concat(g.U(new Set(G)))};
g.t(rfa,Z2);rfa.prototype.X=function(){var G=[];this.j.channelOwner&&G.push(this.j.channelOwner);this.j.playbackPosition&&G.push(this.j.playbackPosition);this.j.localImageEntities&&G.push.apply(G,g.U(this.j.localImageEntities));this.j.downloadStatus&&G.push(this.j.downloadStatus);return[].concat(g.U(new Set(G)))};
g.t($os,Z2);$os.prototype.X=function(){return[]};
g.t(XR7,Z2);XR7.prototype.X=function(){return[]};
g.t(qWf,Z2);qWf.prototype.X=function(){return[]};
g.t(uN$,Z2);uN$.prototype.X=function(){return[]};
g.t(QQJ,Z2);QQJ.prototype.X=function(){return[]};
g.t(LXl,Z2);LXl.prototype.X=function(){return[]};
g.t(Tj2,Z2);Tj2.prototype.X=function(){return[]};
g.t(sQC,Z2);sQC.prototype.X=function(){return[]};
g.t(FXC,Z2);FXC.prototype.X=function(){return[]};
g.t(Jf$,Z2);Jf$.prototype.X=function(){return[]};
g.t(Af7,Z2);Af7.prototype.X=function(){return[]};
g.t(YW2,Z2);YW2.prototype.X=function(){var G=[];this.j.trackDownloadMetadatas&&G.push.apply(G,g.U(this.j.trackDownloadMetadatas));return[].concat(g.U(new Set(G)))};
g.t(icl,Z2);
icl.prototype.X=function(){var G=[];this.j.downloadedTracks&&G.push.apply(G,g.U(this.j.downloadedTracks));this.j.smartDownloadedTracks&&G.push.apply(G,g.U(this.j.smartDownloadedTracks));this.j.downloadedEpisodes&&G.push.apply(G,g.U(this.j.downloadedEpisodes));this.j.downloadedAlbumReleases&&G.push.apply(G,g.U(this.j.downloadedAlbumReleases));this.j.smartDownloadedAlbumReleases&&G.push.apply(G,g.U(this.j.smartDownloadedAlbumReleases));this.j.downloadedPlaylists&&G.push.apply(G,g.U(this.j.downloadedPlaylists));this.j.smartDownloadedPlaylists&&
G.push.apply(G,g.U(this.j.smartDownloadedPlaylists));this.j.metadataOnlyTracks&&G.push.apply(G,g.U(this.j.metadataOnlyTracks));return[].concat(g.U(new Set(G)))};
g.t(PAC,Z2);PAC.prototype.X=function(){var G=[];this.j.trackDownloadMetadatas&&G.push.apply(G,g.U(this.j.trackDownloadMetadatas));return[].concat(g.U(new Set(G)))};
g.t(oOa,Z2);oOa.prototype.X=function(){var G=[];this.j.playbackData&&G.push(this.j.playbackData);this.j.localImageEntities&&G.push.apply(G,g.U(this.j.localImageEntities));this.j.videoDownloadContextEntity&&G.push(this.j.videoDownloadContextEntity);return[].concat(g.U(new Set(G)))};
g.t(Mv7,Z2);Mv7.prototype.X=function(){var G=[];this.j.musicLibraryStatusEntity&&G.push(this.j.musicLibraryStatusEntity);this.j.primaryArtists&&G.push.apply(G,g.U(this.j.primaryArtists));this.j.details&&G.push(this.j.details);this.j.userDetails&&G.push(this.j.userDetails);this.j.tracks&&G.push.apply(G,g.U(this.j.tracks));this.j.share&&G.push(this.j.share);this.j.downloadMetadata&&G.push(this.j.downloadMetadata);this.j.refresh&&G.push(this.j.refresh);return[].concat(g.U(new Set(G)))};
g.t(GeC,Z2);GeC.prototype.X=function(){var G=[];this.j.albumRelease&&G.push(this.j.albumRelease);this.j.tracks&&G.push.apply(G,g.U(this.j.tracks));return[].concat(g.U(new Set(G)))};
g.t(B$a,Z2);B$a.prototype.X=function(){var G=[];this.j.albumRelease&&G.push(this.j.albumRelease);return[].concat(g.U(new Set(G)))};
g.t(a9l,Z2);a9l.prototype.X=function(){var G=[];this.j.details&&G.push(this.j.details);this.j.userDetails&&G.push(this.j.userDetails);return[].concat(g.U(new Set(G)))};
g.t(Vlf,Z2);Vlf.prototype.X=function(){var G=[];this.j.parentArtist&&G.push(this.j.parentArtist);return[].concat(g.U(new Set(G)))};
g.t(xtC,Z2);xtC.prototype.X=function(){var G=[];this.j.parentArtist&&G.push(this.j.parentArtist);return[].concat(g.U(new Set(G)))};
g.t(hx3,Z2);hx3.prototype.X=function(){return[]};
g.t(exa,Z2);exa.prototype.X=function(){return[]};
g.t(Wrh,Ru);Wrh.prototype.X=function(){var G=[];this.j.creatorEntity&&G.push(this.j.creatorEntity);return[].concat(g.U(new Set(G)))};
g.t(w17,Z2);
w17.prototype.X=function(){var G=[];this.j.tracks&&G.push.apply(G,g.U(this.j.tracks));this.j.refresh&&G.push(this.j.refresh);this.j.musicLibraryStatusEntity&&G.push(this.j.musicLibraryStatusEntity);this.j.details&&G.push(this.j.details);this.j.downloadMetadata&&G.push(this.j.downloadMetadata);this.j.sideloadMetadata&&G.push(this.j.sideloadMetadata);this.j.userDetails&&G.push(this.j.userDetails);this.j.entryCollection&&G.push(this.j.entryCollection);this.j.share&&G.push(this.j.share);this.j.podcastShowAdditionalMetadata&&G.push.apply(G,
g.U((new Wrh(this.j.podcastShowAdditionalMetadata)).X()));return[].concat(g.U(new Set(G)))};
g.t(Kr$,Z2);Kr$.prototype.X=function(){return[]};
g.t(l99,Z2);
l99.prototype.X=function(){var G=[];this.j.musicLibraryStatusEntity&&G.push(this.j.musicLibraryStatusEntity);this.j.artists&&G.push.apply(G,g.U(this.j.artists));this.j.audioModeVersion&&G.push(this.j.audioModeVersion);this.j.videoModeVersion&&G.push(this.j.videoModeVersion);this.j.userDetails&&G.push(this.j.userDetails);this.j.details&&G.push(this.j.details);this.j.albumRelease&&G.push(this.j.albumRelease);this.j.share&&G.push(this.j.share);this.j.libraryEdit&&G.push(this.j.libraryEdit);this.j.downloadMetadata&&
G.push(this.j.downloadMetadata);this.j.playbackPosition&&G.push(this.j.playbackPosition);this.j.lyrics&&G.push(this.j.lyrics);return[].concat(g.U(new Set(G)))};
g.t(kea,Z2);kea.prototype.X=function(){var G=[];this.j.parentTrack&&G.push(this.j.parentTrack);return[].concat(g.U(new Set(G)))};
g.t(N$3,Z2);N$3.prototype.X=function(){var G=[];this.j.parentTrack&&G.push(this.j.parentTrack);return[].concat(g.U(new Set(G)))};
g.t(dt8,Z2);dt8.prototype.X=function(){return[]};
g.t(Cr$,Z2);Cr$.prototype.X=function(){return[]};
g.t(zx7,Z2);zx7.prototype.X=function(){return[]};
g.t(tl8,Z2);tl8.prototype.X=function(){return[]};
g.t(mta,Z2);mta.prototype.X=function(){var G=[];this.j.transfer&&G.push(this.j.transfer);this.j.adsPlaybackData&&G.push.apply(G,g.U(this.j.adsPlaybackData));this.j.drmLicense&&G.push(this.j.drmLicense);this.j.offlineVideoPolicy&&G.push(this.j.offlineVideoPolicy);this.j.videoDownloadContextEntity&&G.push(this.j.videoDownloadContextEntity);return[].concat(g.U(new Set(G)))};
g.t(I9C,Z2);I9C.prototype.X=function(){return[]};
g.t(gZl,Z2);gZl.prototype.X=function(){var G=[];this.j.offlineVideoStreams&&G.push.apply(G,g.U(this.j.offlineVideoStreams));this.j.captionTrack&&G.push.apply(G,g.U(this.j.captionTrack));return[].concat(g.U(new Set(G)))};
g.t(p19,Z2);p19.prototype.X=function(){return[]};
g.t(UtC,Z2);UtC.prototype.X=function(){return[]};
g.t(O6a,Z2);O6a.prototype.X=function(){return[]};
g.t(EZk,Z2);EZk.prototype.X=function(){return[]};
g.t(jY8,Z2);jY8.prototype.X=function(){return[]};
g.t(b6W,Z2);b6W.prototype.X=function(){return[]};
g.t(yR8,Z2);yR8.prototype.X=function(){return[]};
g.t(cR$,Z2);cR$.prototype.X=function(){return[]};
g.t(nZh,Z2);nZh.prototype.X=function(){return[]};
g.t(f9J,Z2);f9J.prototype.X=function(){return[]};
g.t(H6s,Z2);H6s.prototype.X=function(){return[]};
g.t(vZC,Z2);vZC.prototype.X=function(){return[]};
g.t(Dt2,Z2);Dt2.prototype.X=function(){return[]};
g.t(S$h,Z2);S$h.prototype.X=function(){return[]};
g.t(Rxk,Z2);Rxk.prototype.X=function(){return[]};
g.t(Z6k,Z2);Z6k.prototype.X=function(){return[]};
g.t(rRJ,Z2);rRJ.prototype.X=function(){return[]};
g.t($tC,Z2);$tC.prototype.X=function(){return[]};
var RO8=["browse","music/browse","unplugged/browse"],q98=["offline/playlist_sync_check"],bt7=["offline"],ZtW=["offline/offline_video_playback_position_sync"],$79=["offline/get_playback_data_entity"],ru;$6.getInstance=function(){return g.v(function(G){return G.return(new Promise(function(B){g.PL().then(function(a){a?($6.instance||($6.instance=new $6(a)),B($6.instance)):B(void 0)})}))})};
$6.prototype.get=function(G){var B=this,a,V,x;return g.v(function(h){if(h.j==1)return g.f(h,QYC(B.token),2);if(h.j!=3)return a=h.X,g.f(h,a.get("prefs",G),3);V=h.X;if(!V)return h.return();x=(0,g.yT)();return V.expirationTimestampMs<=x?h.return():h.return(V.value)})};
$6.prototype.set=function(G,B,a){a=a===void 0?31536E3:a;var V=this,x,h,e;return g.v(function(w){if(w.j==1)return x=(0,g.yT)(),h={key:G,value:B,expirationTimestampMs:x+a*1E3},g.f(w,QYC(V.token),2);e=w.X;return g.f(w,g.DP(e,"prefs",h),0)})};
$6.prototype.remove=function(G){var B=this,a;return g.v(function(V){if(V.j==1)return g.f(V,QYC(B.token),2);a=V.X;return g.f(V,a.delete("prefs",G),0)})};
g.t(XU,g.FI);g.t(qX,JR8);qX.prototype.C=function(G,B){B=Y$2(B);G=(new TextEncoder).encode(JSON.stringify(G));return this.j.encrypt(G,B)};
qX.prototype.X=function(G,B){if(!(G instanceof Uint8Array))throw Lr8(1);var a=new TextDecoder;B=Y$2(B);G=this.j.decrypt(G,B);return JSON.parse(a.decode(G))};
var i6h={accountLinkStatusEntity:do$,booleanEntity:xo7,buttonEntity:H6s,captionTrack:dt8,channelHandle:afs,commerceAcquisitionClientPayloadEntity:Dt2,commerceCartListEntity:S$h,contextNoteFeedEntityPayload:Vvs,continuationTokenEntity:nOC,downloadQualityPickerEntity:mo2,downloadsPageRefreshTokenEntity:gO2,downloadsPageViewConfigurationEntity:$os,downloadStatusEntity:Iff,dismissState:jY8,sfvAudioItemCurrentlyPlayingEntity:UtC,emojiFountainDataEntity:nZh,emojiCustomizationSetEntity:cR$,fakeChannel:ee2,
fakePlaylist:WXh,fakePlaylistEntryCollection:KXW,fakeVideo:lfC,fakeVideoDescription:kUJ,featuredProductsEntity:FXC,flowStateEntity:Njs,iconBadgeEntity:Rxk,interstitialInteractionStateEntity:zea,likeButtonAnimationEntity:XR7,liveChatPollStateEntity:tvJ,liveReactionsDataEntity:f9J,logoEntity:CA$,macroMarkerEntity:qWf,mainDownloadsLibraryEntity:pRs,mainDownloadsListEntity:Oc$,mainPlaylistDownloadStateEntity:EOh,mainPlaylistEntity:fff,mainPlaylistVideoEntity:Hcs,mainVideoDownloadStateEntity:jQ$,mainVideoEntity:Reh,
markersEngagementPanelSyncEntity:uN$,markersVisibilityOverrideEntity:QQJ,musicAlbumReleaseDetail:GeC,musicAlbumReleaseDownloadMetadataEntity:YW2,musicAlbumRelease:Mv7,musicAlbumReleaseUserDetail:B$a,musicArtistDetail:Vlf,musicArtist:a9l,musicArtistUserDetail:xtC,musicDownloadsLibraryEntity:icl,musicLibraryEdit:hx3,musicLibraryStatusEntity:exa,musicPlaylist:w17,musicPlaylistDownloadMetadataEntity:PAC,musicShare:Kr$,musicTrackDetail:kea,musicTrackDownloadMetadataEntity:oOa,musicTrack:l99,musicTrackUserDetail:N$3,
offlineOrchestrationActionWrapperEntity:Cr$,offlineVideoPolicy:zx7,offlineVideoStreams:tl8,offlineabilityEntity:bc7,orchestrationWebSamplingEntity:yfs,pageHeaderEntity:b6W,pdpStateEntity:Z6k,pinnedProductEntity:Jf$,playbackData:mta,playerStateEntity:LXl,quantityIncrementerEntity:rRJ,refresh:I9C,saveToPlaylistListEntity:O6a,settingEntity:EZk,stringEntity:he2,suggestedFeedbackChipStateEntity:Tj2,transfer:gZl,trendingOfferEntity:Af7,videoDownloadContextEntity:p19,videoOverviewAsyncDataEntity:$tC,videoPlaybackPositionEntity:vZC,
votingEntity:yR8,ytMainChannelEntity:Zcl,youchatPendingResponseEntity:sQC,ytMainDownloadedVideoEntity:cf2,ytMainVideoEntity:rfa};g.t(FU,JR8);FU.prototype.C=function(G){return G};
FU.prototype.X=function(G){if(G instanceof Uint8Array)throw Lr8(0);return G};
g.t(Jv,g.r);Jv.prototype.observe=function(G){var B=this;this.observers.push(G);return function(){var a=B.observers.indexOf(G);a>=0&&B.observers.splice(a,1)}};
Jv.prototype.X=function(G){lcl(this,G.data)};
Jv.prototype.yb=function(){this.channel.close()};
var zaJ,kR7=new g.b4("elementsCommand");var OS=new g.b4("entityBatchUpdate");var M3a=new g.b4("downloadStatusEntity");var zRC=new g.b4("mainPlaylistEntityActionMetadata");var AS=new g.b4("mainVideoEntityActionMetadata");var jK8=new g.b4("musicPlaylistEntityActionMetadata");var iml=new g.b4("musicTrackEntityActionMetadata");var Hm7=new g.b4("localImageEntityActionMetadata");var Si=new g.b4("playbackDataActionMetadata");var NAC=new g.b4("transferEntityActionMetadata");var PGa=new g.b4("videoPlaybackPositionEntityActionMetadata");var H4s;new g.z_;new g.z_;Z4a.prototype.request=function(G,B,a){B=B===void 0?{}:B;return this.locks.request(G,B,function(V){return a(V)})};var By=g.qY.caches,GW,uTJ;MX.prototype.open=function(G){return By.open(XO$(G))};
MX.prototype.has=function(G){return By.has(XO$(G))};
MX.prototype.delete=function(G){return By.delete(XO$(G))};
MX.prototype.match=function(G,B){var a=this,V,x,h,e,w,K;return g.v(function(l){switch(l.j){case 1:return g.f(l,a.keys(),2);case 2:V=l.X,x=g.m(V),h=x.next();case 3:if(h.done){l.kf(5);break}e=h.value;return g.f(l,a.open(e),6);case 6:return w=l.X,g.f(l,w.match(G,B),7);case 7:if(K=l.X)return l.return(K);h=x.next();l.kf(3);break;case 5:return l.return()}})};
g.t($VC,MX);$VC.prototype.keys=function(){var G,B,a,V,x,h,e,w,K;return g.v(function(l){if(l.j==1)return G=[],B=g.Jt("CacheStorage keys"),g.f(l,By.keys(),2);a=l.X;V=g.m(a);for(x=V.next();!x.done;x=V.next()){h=x.value;var k=h.indexOf(":");e=k===-1?{aL:h}:{aL:h.substring(0,k),datasyncId:h.substring(k+1)};w=e.aL;K=e.datasyncId;K===B&&G.push(w)}return l.return(G)})};g.t(Vh,g.r);Vh.prototype.C=function(G){this.api.pN("onOfflineOperationFailure",G.data)};
Vh.prototype.G=function(G){this.api.publish("offlinetransferpause",G.data)};
Vh.prototype.yb=function(){var G;(G=this.j)==null||G.close();var B;(B=this.X)==null||B.close()};Txs.prototype.Ry=function(){this.j&&hS(this)};
Txs.prototype.TO=function(){this.X&&this.X.resolve();this.C=this.j=!1;this.Y()};var n0a=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var wd8="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var gmC="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.t(QKa,Hy);QKa.prototype.X=function(G){return KC(G)?sKJ(this,G):lZ(G)?AcW(this,G):Promise.reject(Error("Unsupported action type: "+G.actionType))};g.t(Y97,Hy);Y97.prototype.X=function(G){return lZ(G)?ita(this,G):oas(G)?omC(this,G):kP(G)?Mp2(this,G):Promise.reject(Error("Unsupported action type: "+G.actionType))};g.W=G32.prototype;g.W.Odx=function(G){var B=this,a,V,x,h;return g.v(function(e){if(!g.F(G.state,128))return e.kf(0);a=G.state.CR;var w=(V=a)==null?void 0:V.errorCode,K=(x=a)==null?void 0:x.JT;h=w==="net.connect"&&K===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(w==null?0:w.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.f(e,B.q1(B.player.getVideoData().videoId,h),0)})};
g.W.q1=function(G,B){var a=this;return g.v(function(V){if(V.j==1){if(a.X)return V.return();a.X=!0;return B==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(rn(a,G,!1,!0),V.kf(0)):g.f(V,Z6(a,G),3)}g.f$(G,4);return g.f(V,a.j.q1(B),0)})};
g.W.Jj=function(G){G.status===2?(G.status!==this.C&&(iy9(this.j),g.f$(G.videoId,2)),G.mm&&Bil(this.j,G.videoId,G.mm)):G.status===4?(Z6(this,G.videoId),this.q1(G.videoId,G.H2?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):G.status===1&&GV9(this.j);this.C=G.status;this.api.pN("localmediachange",{videoId:G.videoId,status:G.status})};
g.W.dl=function(){var G=this,B;return g.v(function(a){if(a.j==1){if(G.X)return a.return();G.X=!0;B=G.player.getVideoData().videoId;return g.f(a,Z6(G,B),2)}return g.f(a,G.j.dl(),0)})};
g.W.Ia=function(G){switch(G){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.W.S=function(G){return this.api.U().S(G)};g.t(WK3,Hy);WK3.prototype.X=function(G){return KC(G)?KKs(this,G):lZ(G)?lqs(this,G):oas(G)?k3l(this,G):Promise.reject(Error("Unsupported action type: "+G.actionType))};m1f.prototype.j=function(G,B){var a=G.action.actionMetadata.priority-B.action.actionMetadata.priority;a===0&&(G.j<B.j?a=-1:G.j>B.j&&(a=1));return a};g.t($P,g.r);$P.prototype.yb=function(){this.Y&&this.Y();g.r.prototype.yb.call(this)};
$P.prototype.createAction=function(G,B){var a=g.e9(G.entityKey).entityType,V=g.Et(16);return new tS(a,V,G,B.actionId,B.rootActionId)};
$P.prototype.XJ=function(G){var B=this,a,V,x,h,e,w,K,l,k;return g.v(function(N){if(N.j==1){if(B.TH())return N.return();V=(a=G.offlineOrchestrationActionWrapperEntity)!=null?a:new Set;x=[];h=g.m(V);for(e=h.next();!e.done;e=h.next())w=e.value,K=g.e9(w),l=K.entityId,pG8(B.j,l)||x.push(w);return g.f(N,v08(B,x),2)}k=N.X;return g.f(N,Hyf(B,k),0)})};
$P.prototype.retry=function(){var G=this;return g.v(function(B){return g.f(B,D1s(G),0)})};Rmk.prototype.gJ=function(G,B){B=B===void 0?!0:B;var a=this,V,x,h,e,w,K,l,k;return g.v(function(N){switch(N.j){case 1:if(!a.j)return N.return();V=[];x=g.ha(a.j.X,B);h=[];for(e={XI:0};e.XI<x.length;e={XI:e.XI},e.XI++)w=x[e.XI],K=a.j.i9(w,"json3"),l=g.fB(K,{withCredentials:!0,format:"RAW"},3,500).then(function(d){return function(C){C={metadata:g.C$(x[d.XI]),trackData:C.xhr.responseText};h.push(C)}}(e)).yC(function(d){a8("Caption fetch error",d)}),V.push(l);
return g.f(N,Bjf(V),2);case 2:return g.UA(N,3),g.f(N,Eas(G,h),5);case 5:g.EA(N,0);break;case 3:k=g.jB(N),a8("Caption DB transaction error",k),g.pV(N)}})};g.t(Xl,g.r);Xl.prototype.yb=function(){this.X&&this.X();g.r.prototype.yb.call(this)};
Xl.prototype.C=function(G){var B=this,a,V,x,h,e,w,K,l;return g.v(function(k){V=(a=G.transfer)!=null?a:new Set;x=[];h=g.m(V);for(e=h.next();!e.done;e=h.next())w=e.value,K=g.e9(w),l=K.entityId,x.push(l);return x.length===0?k.return():g.f(k,$12(B,x),0)})};g.t(LKf,g.r);g.W=LKf.prototype;g.W.yb=function(){this.HS&&this.HS();this.GH.dispose();this.G.dispose();this.Qb&&g.$o(this.L.JW,this.Qb);this.LN&&g.$o(this.L.JW,this.LN);g.r.prototype.yb.call(this)};
g.W.YvN=function(G){var B=this,a,V,x;return g.v(function(h){switch(h.j){case 1:a=g.WS(G,"transfer");if(B.j&&a===B.j.key){rn(B.W,B.B,!0);B.G.stop();h.kf(0);break}return g.f(h,Av(B.X,{mode:"readwrite",hs:!0},function(e){return uJ(e,a,"transfer").then(function(w){if(w&&w.transferState!=="TRANSFER_STATE_COMPLETE"&&w.transferState!=="TRANSFER_STATE_FAILED")return w.transferState="TRANSFER_STATE_PAUSED_BY_USER",Tr(e,w,"transfer").then(function(){return w})})}),3);
case 3:V=h.X;if(!V){h.kf(0);break}if(!G||!B.C){h.kf(5);break}return g.f(h,Ni(G,B.C,B.X,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.f(h,Qh(B,G),7);case 7:x=h.X,i4f({videoId:G,oe:V,offlineModeType:x}),g.pV(h)}})};
g.W.Ncl=function(){var G=this;if(this.j&&this.B){rn(this.W,this.B,!1);var B=this.j,a=(B==null?0:B.key)?g.e9(B.key).entityId:"";a&&this.C&&(new Promise(function(V,x){Ni(a,G.C,G.X,"DOWNLOAD_STATE_PAUSED").catch(function(h){x(h)})})).catch(function(V){a8("Download state setting error",V)})}this.G.stop()};
g.W.A5=function(){this.j?FK2(this,this.j):uZ(this)};
g.W.EV=function(G){var B=this;return g.v(function(a){switch(a.j){case 1:if(!B.j){a.kf(2);break}if(B.j.transferState==="TRANSFER_STATE_COMPLETE"||B.j.transferState==="TRANSFER_STATE_FAILED"||!G.transfer||!G.transfer.has(B.j.key)){a.kf(3);break}return g.f(a,iJ(B.X,B.j.key,"transfer"),4);case 4:B.j=a.X;if(B.j){a.kf(3);break}return g.f(a,J8k(B),3);case 3:if(B.j)return a.return();case 2:return g.f(a,uZ(B),0)}})};
g.W.q1=function(G,B){var a=this,V,x,h,e,w;return g.v(function(K){switch(K.j){case 1:if(!a.j){LC(a,"onTransferFailure: "+G);K.kf(2);break}V=a.j;h=((x=V)==null?0:x.key)?g.e9(V.key).entityId:"";a:switch(G){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var l=!1;break a;default:l=!0}return l&&aA3(a)?g.f(K,TW(a,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.f(K,
Vbh(a,G),5);case 5:if(!h||!a.C){K.kf(2);break}return g.f(K,Ni(h,a.C,a.X,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.f(K,Qh(a,h),9);case 9:e=K.X;Wy({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:h,oe:V,offlineModeType:e});if(!h||!a.C){K.kf(2);break}return g.f(K,Ni(h,a.C,a.X,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:qi(a),w=uZ(a,!0),B&&B(w),g.pV(K)}})};
g.W.dl=function(G){var B=this,a,V,x,h,e,w,K,l,k,N,d,C;return g.v(function(z){switch(z.j){case 1:if(!B.j){LC(B,"onMaybeTransferStreamsExpired");z.kf(2);break}return aA3(B)?g.f(z,TW(B,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.f(z,Vbh(B,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!B.C){z.kf(2);break}a=B.j;x=((V=a)==null?0:V.key)?g.e9(a.key).entityId:"";if(!x){z.kf(2);break}return g.f(z,Ni(x,B.C,B.X,"DOWNLOAD_STATE_FAILED"),2);case 9:return B.j||LC(B,"onMaybeTransferStreamsExpiredRetryAttempting"),
h=B.j,w=((e=h)==null?0:e.key)?g.e9(h.key).entityId:"",g.f(z,Qh(B,w),10);case 10:return K=z.X,Wy({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:w,oe:h,offlineModeType:K}),l=apa(),g.uY(l,Si,{isEnqueuedForExpiredStreamUrlRefetch:!0}),k=g.WS(w,"playbackData"),N={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:k,actionMetadata:l},d=I8(new tS("playbackData",w,N)),g.f(z,Y6(B.X,d,"offlineOrchestrationActionWrapperEntity"),2);case 2:qi(B),C=uZ(B,!0),
G&&G(C),g.pV(z)}})};
var Wpa={},x4k=(Wpa.TRANSFER_STATE_TRANSFERRING=1,Wpa.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,Wpa);g.W=sS.prototype;g.W.Nz=function(){return this.B.promise};
g.W.R5=function(){if(this.X&&this.W)return this.B.promise;WuW(this).then(this.B.resolve).catch(this.B.reject);return this.B.promise};
g.W.VQ=function(G){var B={};return B.playbackData=new QKa(G,this.md,this.j),B.transfer=new WK3(G,this.md),B.videoPlaybackPositionEntity=new Y97(G,this.md),B};
g.W.S5=function(){var G=this;return g.v(function(B){return G.X?g.f(B,TA8(G.X),0):B.kf(0)})};
g.W.ZN=function(){var G=this,B,a;return g.v(function(V){if(V.j==1)return G.X||G.W?g.f(V,G.Nz(),2):V.return();G.V!==void 0&&(g.Ih(G.V),G.V=void 0);G.G!==void 0&&(g.Ih(G.G),G.G=void 0);(B=G.X)==null||B.dispose();G.X=void 0;(a=G.W)==null||a.dispose();G.W=void 0;G.api.pN("onOrchestrationLostLeader");G.B=new g.z_;g.pV(V)})};
g.W.isOrchestrationLeader=function(){return this.C.j};
g.W.GE=function(){return g.v(function(G){return G.return(!1)})};
g.W.p_=function(G){var B=this.j;B.api.publish("offlinetransferpause",G);var a;(a=B.X)==null||a.postMessage(G)};
g.W.A5=function(G){var B,a;return g.v(function(V){if(V.j==1)return g.f(V,ou(),2);B=V.X;if(!B)return V.return();a=g.WS(G,"transfer");return g.f(V,Av(B,{mode:"readwrite",hs:!0},function(x){var h=uJ(x,a,"transfer"),e=uJ(x,g.WS(G,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.OV.all([h,e]).then(function(w){w=g.m(w);var K=w.next().value;var l=w.next().value;return K&&K.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(K.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",Tr(x,K,"transfer").then(function(){Wy({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:G,oe:K,offlineModeType:l==null?void 0:l.offlineModeType});return g.OV.resolve(null)})):g.OV.resolve(null)})}),0)})};
g.W.cg=function(G){G=G===void 0?43200:G;var B=this,a,V,x,h,e,w,K,l;return g.v(function(k){if(k.j==1)return B.L.JA()?g.f(k,ou(),2):k.return(wCJ());if(k.j!=3){a=k.X;if(!a)return k.return([]);V=Date.now()/1E3;return g.f(k,Pc(a,"offlineVideoPolicy"),3)}x=k.X;h=[];e=g.m(x);for(w=e.next();!w.done;w=e.next())K=w.value,Number(K.lastUpdatedTimestampSeconds)+G<=V&&(l=g.e9(K.key).entityId,h.push(l));return h.length?k.return(Fl(B,h,B.Y,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):k.return([])})};
g.W.deleteAll=function(){return Fl(this,["!*$_ALL_ENTITIES_!*$"],this.Y,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.W.refreshAllStaleEntities=function(G){var B=this;return g.v(function(a){return a.j==1?g.f(a,B.cg(G),2):a.return(a.X)})};
g.W.setUpPositionSyncInterval=function(G){var B=this;this.G!==void 0&&(g.Ih(this.G),this.G=void 0);var a=G!=null?G:864E5;this.G=g.tM(function(){B.oh(a)},a)};
g.W.oh=function(G){var B=this,a,V,x,h,e,w;return g.v(function(K){switch(K.j){case 1:return g.UA(K,2),g.f(K,$6.getInstance(),4);case 4:a=K.X;if(!a)throw Error("prefStorage is undefined");return g.f(K,a.get("psi"),5);case 5:V=K.X;h=((x=V)==null?0:x.Gl)?Number(V.Gl)/1E3:0;e=Date.now();if(!(h+G<=e)){K.kf(6);break}return g.f(K,Fl(B,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.EA(K,0);break;case 2:w=g.jB(K),a8("Offline manager error",w),
g.pV(K)}})};
g.W.Lq=function(){var G=this,B,a,V,x,h,e,w;return g.v(function(K){if(K.j==1)return g.f(K,ou(),2);if(K.j!=3)return(B=K.X)?g.f(K,Pc(B,"transfer"),3):K.return([]);a=K.X;V=[];x=g.m(a);for(h=x.next();!h.done;h=x.next())e=h.value,e.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&e.key&&(w=g.e9(e.key).entityId,V.push(w));return K.return(lAs(G,V))})};
g.W.L0=function(){return g.v(function(G){return G.return([])})};
g.W.bS=function(){return g.v(function(G){g.pV(G)})};
g.W.WW=function(){return g.v(function(G){g.pV(G)})};g.t(kVh,Hy);kVh.prototype.X=function(G){return KC(G)?Cu3(this,G):lZ(G)?tbW(this,G):kP(G)?m4W(this,G):Promise.reject(Error("Unsupported action type: "+G.actionType))};
var JS=[10];g.t(OmC,Hy);OmC.prototype.X=function(G){return KC(G)?bmh(this,G):lZ(G)?yis(this,G):kP(G)?cif(this,G):Promise.reject(Error("Unsupported action type: "+G.actionType))};
var jRW=[10];g.t(fAs,Hy);fAs.prototype.X=function(G){return lZ(G)?v$h(this,G):Promise.reject(Error("Unsupported action type: "+G.actionType))};g.t(D4J,sS);g.W=D4J.prototype;g.W.VQ=function(G){var B=sS.prototype.VQ.call(this,G);B.mainVideoEntity=new OmC(G,this.md,this.j);B.mainPlaylistEntity=new kVh(G,this.md,this.j);B.mainDownloadsListEntity=new fAs(G,this.md,this.j);return B};
g.W.refreshAllStaleEntities=function(G,B){var a=this,V,x,h,e,w,K,l,k,N,d,C;return g.v(function(z){switch(z.j){case 1:V=[];if(!a.md.S("web_player_offline_playlist_auto_refresh")){z.kf(2);break}return g.f(z,SJW(a,G,B),3);case 3:V=z.X;case 2:return g.f(z,$6.getInstance(),4);case 4:return x=z.X,g.f(z,(h=x)==null?void 0:h.get("sdois"),5);case 5:return e=z.X,g.f(z,(w=x)==null?void 0:w.get("lmqf"),6);case 6:K=z.X;if(!e){z.kf(7);break}k=V;N=k.concat;return g.f(z,RRl(a,e,(l=K)!=null?l:"SD",G===0),8);case 8:V=
N.call(k,z.X);case 7:return d=V,C=d.concat,g.f(z,sS.prototype.refreshAllStaleEntities.call(a,G,B),9);case 9:return V=C.call(d,z.X),z.return(V)}})};
g.W.GE=function(G){var B,a,V,x,h,e,w,K;return g.v(function(l){if(l.j==1)return g.f(l,ou(),2);if(l.j!=3)return(B=l.X)?g.f(l,iJ(B,g.S4,"mainDownloadsListEntity"),3):l.return(!1);a=l.X;if((V=a)==null?0:(x=V.downloads)==null?0:x.length)for(h=g.WS(G,"mainVideoEntity"),e=g.m(a.downloads),w=e.next();!w.done;w=e.next())if(K=w.value,K.videoItem===h)return l.return(!0);return l.return(!1)})};
g.W.L0=function(){var G=this,B,a,V,x,h,e,w,K;return g.v(function(l){if(l.j==1)return g.f(l,ou(),2);if(l.j!=3)return(B=l.X)?g.f(l,Pc(B,"downloadStatusEntity"),3):l.return([]);a=l.X;V=[];x=g.m(a);for(h=x.next();!h.done;h=x.next())e=h.value,e.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&e.key&&(w=g.e9(e.key).entityId,V.push(w));return V.length?(K={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},l.return(Fl(G,V,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
K))):l.return([])})};
g.W.WW=function(){var G;return g.v(function(B){return B.j==1?g.f(B,ou(),2):(G=B.X)?g.f(B,Av(G,{mode:"readwrite",hs:!0},function(a){return Qf(a,"mainVideoEntity").then(function(V){var x=[];V=g.m(V);for(var h=V.next();!h.done;h=V.next()){h=h.value;var e=void 0;(e=h.userState)!=null&&e.playbackPosition||(e=g.e9(h.key).entityId,e={key:g.WS(e,"videoPlaybackPositionEntity"),videoId:e,lastPlaybackPositionSeconds:"0"},x.push(Tr(a,e,"videoPlaybackPositionEntity")),h.userState={playbackPosition:e.key},x.push(Tr(a,
h,"mainVideoEntity")))}return g.OV.all(x)})}),0):B.return()})};
g.W.bS=function(){var G,B,a,V,x,h,e,w,K,l,k,N,d,C,z,p,O,b,c,H,R,q,A,J,xB,Wz,GK,Q,M,I,L,ux,U3,dl,cz,Pz,hJ,tJ;return g.v(function(E){if(E.j==1)return g.f(E,ou(),2);if(E.j!=3){G=E.X;if(!G)return E.return();B=g.WS("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.f(E,Av(G,{mode:"readonly",hs:!0},function(y){return g.OV.all([uJ(y,B,"mainDownloadsListEntity"),uJ(y,g.S4,"mainDownloadsListEntity"),Qf(y,"mainVideoEntity"),Qf(y,"mainPlaylistEntity")])}),3)}a=E.X;
V=g.m(a);x=V.next().value;h=V.next().value;e=V.next().value;w=V.next().value;K=x;l=h;k=e;N=w;d=new Set;if((C=K)==null?0:(z=C.downloads)==null?0:z.length)for(p=g.m(K.downloads),O=p.next();!O.done;O=p.next())b=O.value,c=void 0,(H=(c=b.videoItem)!=null?c:b.playlistItem)&&d.add(H);if((R=l)==null?0:(q=R.downloads)==null?0:q.length)for(A=g.m(l.downloads),J=A.next();!J.done;J=A.next())xB=J.value,xB.videoItem&&d.add(xB.videoItem);Wz=new Set;GK=[];Q=g.m(N);for(M=Q.next();!M.done;M=Q.next()){I=M.value;if(I.videos)for(L=
g.m(I.videos),ux=L.next();!ux.done;ux=L.next())U3=ux.value,(dl=JSON.parse(g.e9(U3).entityId).videoId)&&Wz.add(dl);I.key&&!d.has(I.key)&&GK.push(I.key)}cz=g.m(k);for(Pz=cz.next();!Pz.done;Pz=cz.next())hJ=Pz.value,hJ.key&&!d.has(hJ.key)&&(tJ=g.e9(hJ.key).entityId,Wz.has(tJ)||GK.push(hJ.key));return GK.length?g.f(E,zO3(G,GK),0):E.kf(0)})};g.t(Zmh,Hy);Zmh.prototype.X=function(G){return KC(G)?$49(this,G):lZ(G)?XC7(this,G):kP(G)?qJC(this,G):Promise.reject(Error("Unsupported action type: "+G.actionType))};
var YP=[10];g.t(QRC,Hy);QRC.prototype.X=function(G){return KC(G)?TiC(this,G):lZ(G)?sRf(this,G):kP(G)?FuC(this,G):Promise.reject(Error("Unsupported action type: "+G.actionType))};
var iZ=[10];g.t(YJ$,Hy);YJ$.prototype.X=function(G){return KC(G)?Mbf(this,G):lZ(G)?GY8(this,G):kP(G)?BLW(this,G):Promise.reject(Error("Unsupported action type: "+G.actionType))};
var o$f=[10];g.t(Py,sS);Py.prototype.VQ=function(G){var B=sS.prototype.VQ.call(this,G);B.musicTrack=new YJ$(G,this.j);B.musicPlaylist=new QRC(G,this.j);B.musicAlbumRelease=new Zmh(G,this.j);return B};
Py.prototype.refreshAllStaleEntities=function(G,B){var a=this,V,x,h;return g.v(function(e){if(e.j==1)return g.f(e,VVh(a,G,B),2);if(e.j!=3)return x=V=e.X,h=x.concat,g.f(e,sS.prototype.refreshAllStaleEntities.call(a,G,B),3);V=h.call(x,e.X);return e.return(V)})};g.t(xlC,g.go);g.W=xlC.prototype;g.W.create=function(){var G=this;g.X(this,this.events);g.YF(this.md)?this.j=new D4J(this.md,this.player):g.rv(this.md)&&(this.j=new Py(this.md,this.player));this.events.K(this.player,"onPlaybackStartExternal",function(){G.zb()});
this.events.K(this.player,"videodatachange",function(){G.zb()});
this.md.S("html5_offline_playback_position_sync")&&this.events.K(this.player,"presentingplayerstatechange",this.LA)};
g.W.v6=function(){return!1};
g.W.zR=function(G,B,a,V){var x=this;return g.v(function(h){return x.j?h.return(Fl(x.j,G,B,a,V)):h.return(Promise.reject())})};
g.W.deleteAll=function(){return this.j.deleteAll()};
g.W.cg=function(G){return this.j.cg(G)};
g.W.refreshAllStaleEntities=function(G){return this.j.refreshAllStaleEntities(G)};
g.W.setUpPositionSyncInterval=function(G){this.j.setUpPositionSyncInterval(G)};
g.W.p_=function(G){this.j.p_(G)};
g.W.A5=function(G){return this.j.A5(G)};
g.W.zb=function(){var G=this,B;return g.v(function(a){B=G.player.getVideoData();return g.oS(B)?hyJ(B)&&G.X!==B.clientPlaybackNonce?g.f(a,eyk(G,B),0):a.kf(0):a.return()})};
g.W.LA=function(G){var B=this,a,V,x,h,e,w,K;return g.v(function(l){if(l.j==1)return a=B.player.getVideoData(),V=a.Er,g.CY(G,2)||g.CY(G,512)?g.f(l,ou(),2):l.return();if(l.j!=3){x=l.X;if(!x)return a8("PES is undefined"),l.return();h=a.videoId;return g.f(l,iJ(x,g.WS(h,"mainVideoEntity"),"mainVideoEntity"),3)}e=l.X;if(!e)return l.return();w=Math.floor(V).toString();K={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:w}};return g.f(l,B.zR([h],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
K),0)})};
g.W.isOrchestrationLeader=function(){return this.j.isOrchestrationLeader()};
g.W.updateDownloadState=function(G,B){var a,V,x,h;return g.v(function(e){if(e.j==1)return g.f(e,ou(),2);a=e.X;if(!a)return a8("PES is undefined"),e.return();V=g.e9(G);x=V.entityType;h=V.entityId;return g.f(e,Ni(h,x,a,B,!0),0)})};g.Is("offline",xlC);})(_yt_player);
